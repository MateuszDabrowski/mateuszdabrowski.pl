(self.webpackChunkmd=self.webpackChunkmd||[]).push([[5244],{6355:(e,t,i)=>{e.exports={src:{srcSet:i.p+"assets/ideal-img/article-image-is-serverside-purpose.8648fba.640.png 640w,"+i.p+"assets/ideal-img/article-image-is-serverside-purpose.5bba003.1030.png 1030w",images:[{path:i.p+"assets/ideal-img/article-image-is-serverside-purpose.8648fba.640.png",width:640,height:418},{path:i.p+"assets/ideal-img/article-image-is-serverside-purpose.5bba003.1030.png",width:1030,height:672}],src:i.p+"assets/ideal-img/article-image-is-serverside-purpose.8648fba.640.png",toString:function(){return i.p+"assets/ideal-img/article-image-is-serverside-purpose.8648fba.640.png"},placeholder:void 0,width:640,height:418},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+0lEQVQImWNQK9zNa1C+j0Vh9isGW4tmBhvt8uj4gAn/rTTKUrU1Gxi6A2vZb8WlMDFI5ewzd2w7XW5SczSOoeochyt/jlCgcWlSkGaJ9EbvBIa3jc0Mt+NSGBismk7ZOHeeizKqPlLB8PY/k6BlspVDQvNFBotUu/ehwSE3kjJ3XAuLrWawqD/q7NR2Ms605nA5w///DIIWyfaOiS13GMzTnN6GhKTcTMm+ei0sdiKDctEBU6f2MxUmNUdTGCpOcHnxZfO7aWZH+yjlim/0jGV4A7NapWCvgGbJPg7N5R8YrIwbGCzVS2OCHNv/W6iVpKmr1DJ0+teAPQMAjg1cf+UFakAAAAAASUVORK5CYII="}},5783:(e,t,i)=>{e.exports={src:{srcSet:i.p+"assets/ideal-img/article-image-is-serverside-template-ui.23a8fb4.640.png 640w,"+i.p+"assets/ideal-img/article-image-is-serverside-template-ui.d56a10a.1030.png 1030w",images:[{path:i.p+"assets/ideal-img/article-image-is-serverside-template-ui.23a8fb4.640.png",width:640,height:302},{path:i.p+"assets/ideal-img/article-image-is-serverside-template-ui.d56a10a.1030.png",width:1030,height:486}],src:i.p+"assets/ideal-img/article-image-is-serverside-template-ui.23a8fb4.640.png",toString:function(){return i.p+"assets/ideal-img/article-image-is-serverside-template-ui.23a8fb4.640.png"},placeholder:void 0,width:640,height:302},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlUlEQVQImTWLSQ6CQBQFuf+5jCuDQwwaYxBRhkBjI0gz/zJNtDbvLaqcW6w4+FeuQUCmNFqXeGHB6hixOT9Yux47d4vzVDWxKjn5CftLzD1S9F37izSWaRxx7BEgexvyqqWoDKYbSHVD/ippTIvpeisKIsI8T0siMi9rgyCMSNOMJK9xRFjEv2C/pekGdFlh6g/DOPMFD8G+gW8M8tUAAAAASUVORK5CYII="}},7661:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var a=i(7294),n=i(6010),r=i(8259),o=i(3699),s=i(2735),l=i(7325);const d={cardContainer:"cardContainer_fWXF",cardTitle:"cardTitle_rnsV",cardDescription:"cardDescription_PWke"};function p(e){let{href:t,children:i}=e;return a.createElement(o.Z,{href:t,className:(0,n.Z)("card padding--lg",d.cardContainer)},i)}function c(e){let{href:t,icon:i,title:r,description:o}=e;return a.createElement(p,{href:t},a.createElement("h2",{className:(0,n.Z)("text--truncate",d.cardTitle),title:r},i," ",r),o&&a.createElement("p",{className:(0,n.Z)("text--truncate",d.cardDescription),title:o},o))}function m(e){let{item:t}=e;const i=(0,r.Wl)(t);return i?a.createElement(c,{href:i,icon:"\ud83d\uddc3\ufe0f",title:t.label,description:t.description??(0,l.I)({message:"{count} items",id:"theme.docs.DocCard.categoryDescription",description:"The default description for a category card in the generated index about how many items this category includes"},{count:t.items.length})}):null}function u(e){let{item:t}=e;const i=(0,s.Z)(t.href)?"\ud83d\udcc4\ufe0f":"\ud83d\udd17",n=(0,r.xz)(t.docId??void 0);return a.createElement(c,{href:t.href,icon:i,title:t.label,description:t.description??n?.description})}function g(e){let{item:t}=e;switch(t.type){case"link":return a.createElement(u,{item:t});case"category":return a.createElement(m,{item:t});default:throw new Error(`unknown item type ${JSON.stringify(t)}`)}}function h(e){let{className:t}=e;const i=(0,r.jA)();return a.createElement(f,{items:i.items,className:t})}function f(e){const{items:t,className:i}=e;if(!t)return a.createElement(h,e);const o=(0,r.MN)(t);return a.createElement("section",{className:(0,n.Z)("row",i)},o.map(((e,t)=>a.createElement("article",{key:t,className:"col col--6 margin-bottom--lg"},a.createElement(g,{item:e})))))}},7271:(e,t,i)=>{"use strict";i.d(t,{V:()=>r,z:()=>n});var a=i(7294);const n=e=>{let{link:t,text:i,newTab:n=!1}=e;return a.createElement(a.Fragment,null,a.createElement("a",{class:"button button--outline button--lg button--primary col col--6 col--offset-3",href:t,target:n?"_blank":"_self"},i))},r=e=>{let{linkLeft:t,textLeft:i,newTabLeft:n=!1,linkRight:r,textRight:o,newTabRight:s=!1}=e;return a.createElement(a.Fragment,null,a.createElement("div",{class:"col col--12"},a.createElement("a",{class:"button button--outline button--lg button--primary col col--5 col--offset-0",href:t,target:n?"_blank":"_self"},i),a.createElement("a",{class:"button button--outline button--lg button--primary col col--5 col--offset-2",href:r,target:s?"_blank":"_self"},o)))}},1872:(e,t,i)=>{"use strict";i.d(t,{m:()=>r});var a=i(7294);const n="leadText_qzwo",r=e=>{let{content:t}=e;return a.createElement(a.Fragment,null,a.createElement("p",{id:n},t))}},6280:(e,t,i)=>{"use strict";i.r(t),i.d(t,{assets:()=>f,contentTitle:()=>g,default:()=>C,frontMatter:()=>u,metadata:()=>h,toc:()=>b});var a=i(7462),n=(i(7294),i(4137)),r=i(1872),o=i(7271),s=i(7661),l=i(5944),d=i(6355),p=i.n(d),c=i(5783),m=i.n(c);const u={id:"mcp-serverside-code-basics",title:"MCP Serverside Code Basics",sidebar_label:"Serverside Code Basics",description:"Wrap your head around the core feature of Marketing Cloud Personalization (Interaction Studio) and build the bridge between marketer and customer.",image:"img/og/og-image-mcp-serverside-code-basics.png",tags:["Marketing Cloud","Marketing Cloud Personalization","Interaction Studio","Personalisation","TypeScript"]},g=void 0,h={unversionedId:"interaction-studio/mcp-serverside-code-basics",id:"interaction-studio/mcp-serverside-code-basics",title:"MCP Serverside Code Basics",description:"Wrap your head around the core feature of Marketing Cloud Personalization (Interaction Studio) and build the bridge between marketer and customer.",source:"@site/docs/interaction-studio/mcp-serverside-code-basics.mdx",sourceDirName:"interaction-studio",slug:"/interaction-studio/mcp-serverside-code-basics",permalink:"/docs/interaction-studio/mcp-serverside-code-basics",draft:!1,editUrl:"https://github.com/MateuszDabrowski/mateuszdabrowski.pl/edit/master/docs/interaction-studio/mcp-serverside-code-basics.mdx",tags:[{label:"Marketing Cloud",permalink:"/docs/tags/marketing-cloud"},{label:"Marketing Cloud Personalization",permalink:"/docs/tags/marketing-cloud-personalization"},{label:"Interaction Studio",permalink:"/docs/tags/interaction-studio"},{label:"Personalisation",permalink:"/docs/tags/personalisation"},{label:"TypeScript",permalink:"/docs/tags/type-script"}],version:"current",lastUpdatedBy:"Mateusz D\u0105browski",lastUpdatedAt:1697570418,formattedLastUpdatedAt:"Oct 17, 2023",frontMatter:{id:"mcp-serverside-code-basics",title:"MCP Serverside Code Basics",sidebar_label:"Serverside Code Basics",description:"Wrap your head around the core feature of Marketing Cloud Personalization (Interaction Studio) and build the bridge between marketer and customer.",image:"img/og/og-image-mcp-serverside-code-basics.png",tags:["Marketing Cloud","Marketing Cloud Personalization","Interaction Studio","Personalisation","TypeScript"]},sidebar:"docs",previous:{title:"Serverside Code",permalink:"/docs/category/serverside-code"},next:{title:"Serverside Code Properties",permalink:"/docs/interaction-studio/mcp-serverside-code-properties"}},f={},b=[{value:"MCP Serverside Code Purpose",id:"mcp-serverside-code-purpose",level:2},{value:"MCP Serverside Code Basics",id:"mcp-serverside-code-basics",level:2},{value:"Writing Serverside Code",id:"writing-serverside-code",level:2},{value:"1. Field Configuration",id:"1-field-configuration",level:3},{value:"2. Run Block",id:"2-run-block",level:3},{value:"3. Return Statement",id:"3-return-statement",level:3},{value:"All MCP Serverside Code Guides",id:"all-mcp-serverside-code-guides",level:2},{value:"Learn more",id:"learn-more",level:2}],k={toc:b},v="wrapper";function C(e){let{components:t,...i}=e;return(0,n.kt)(v,(0,a.Z)({},k,i,{components:t,mdxType:"MDXLayout"}),(0,n.kt)(r.m,{content:"Wrap your head around the core feature of Marketing Cloud Personalization (Interaction Studio) and build the bridge between marketer and customer.",mdxType:"LeadText"}),(0,n.kt)("h2",{id:"mcp-serverside-code-purpose"},"MCP Serverside Code Purpose"),(0,n.kt)("p",null,"Whether you are creating a Web, Serverside or Triggered Campaign Template in the Marketing Cloud Personalization (Interaction Studio), you start with the Serverside Code tab. It is the true heart of the MCP platform responsible for delivering data-driven personalisations."),(0,n.kt)("p",null,"The developer can use the Serverside Code to:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"leverage user profile and behavioural data"),(0,n.kt)("li",{parentName:"ul"},"lookup company catalog data"),(0,n.kt)("li",{parentName:"ul"},"build campaign configuration and use provided data"),(0,n.kt)("li",{parentName:"ul"},"select and pull Einstein Recipe recommendations")),(0,n.kt)("p",null,"to output a transformed payload containing everything needed for a unique experience for each customer."),(0,n.kt)(l.Z,{img:p(),alt:"Graph displaying the purpose of Serverside code as a centre collecting data, configuration and recommendations to output personalisation payload",mdxType:"Image"}),(0,n.kt)("hr",null),(0,n.kt)("h2",{id:"mcp-serverside-code-basics"},"MCP Serverside Code Basics"),(0,n.kt)("p",null,"All the above things are done within the Serverside Code tab of the MC Personalization Template creation UI with TypeScript programming language and built-in functions. Don't worry if you don't know TypeScript - basic knowledge of modern JavaScript is enough to create good templates."),(0,n.kt)("admonition",{title:"You Should Know",type:"note"},(0,n.kt)("p",{parentName:"admonition"},"Open Time Email Campaigns are using different, older system. I covered its details in a ",(0,n.kt)("a",{parentName:"p",href:"/docs/interaction-studio/mcp-open-time-email"},"separate guide"),".")),(0,n.kt)("p",null,"When you open the Serverside Code tab in a new Template creation screen for Web, Serverside or Triggered Campaign within the Marketing Cloud Personalization, you will be greeted by a bit intimidating interface. Let's start by breaking it down section by section:"),(0,n.kt)(l.Z,{img:m(),alt:"Marketing Cloud Personalization Serverside Template UI screenshot",mdxType:"Image"}),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"The middle pane contains your TypeScript code responsible for all the magic happening on the server side."),(0,n.kt)("li",{parentName:"ol"},"Within the middle section (1), you will see two sections. The first one is responsible for defining the Campaign configuration form. In the screenshot above, a ",(0,n.kt)("inlineCode",{parentName:"li"},"header")," field is defined as a ",(0,n.kt)("inlineCode",{parentName:"li"},"string")," and decorated with a custom title."),(0,n.kt)("li",{parentName:"ol"},"The form definitions you develop (2) will be available for a preview on the left pane. This section lets you see what the Campaign Configuration screen will look like and enables you to fill it in to see the interactions."),(0,n.kt)("li",{parentName:"ol"},"Returning to the middle section (1), below the configuration form definitions (2), you will find the ",(0,n.kt)("inlineCode",{parentName:"li"},"run")," function with ",(0,n.kt)("inlineCode",{parentName:"li"},"context")," being passed as an argument. This is where you can optionally transform or enrich the data captured from the configuration form. The ",(0,n.kt)("inlineCode",{parentName:"li"},"context")," provided to the function contains triggering event data and access to many helper functions to bring your template to the next level. You can also add properties (for example, debugging details) to the returned object to make them available in the payload (5)."),(0,n.kt)("li",{parentName:"ol"},"The bottom part of the right pane displays the Payload Preview. It is updated in real-time as you write your TypeScript (1) or change the configuration (3). it is an excellent way to validate whether you are getting the desired outcome."),(0,n.kt)("li",{parentName:"ol"},"If your template leverages user or catalog data (for example, user attributes for personalisation or anchored recipes) to see the proper payload, you must provide example data. The top section of the right pane lets you do it. You can add the IDs and see the payload (5) adapt to the simulated scenario.")),(0,n.kt)("p",null,"The final outcome of your work in this tab is the personalised payload (5). Depending on the type of campaign this template is for, it will either be delivered as is (Serverside), put into a Data Extension (Triggered Campaign) or be available to leverage for logic in Clientside Code and experience in Handlebars tabs (Web Campaign)."),(0,n.kt)("admonition",{title:"You Should Know",type:"note"},(0,n.kt)("p",{parentName:"admonition"},"If you don't see ",(0,n.kt)("inlineCode",{parentName:"p"},"experience")," or ",(0,n.kt)("inlineCode",{parentName:"p"},"campaign")," in the payload object (5), it means there is a bug in your template code (1)."),(0,n.kt)("p",{parentName:"admonition"},"If you don't see the configuration form preview (3) updates despite making changes in the serverside code (1), MCP probably froze. Check whether you are still logged in to the MC Personalization (MCP session length is shorter than SFMC's). If yes, cut (",(0,n.kt)("inlineCode",{parentName:"p"},"ctrl"),"/",(0,n.kt)("inlineCode",{parentName:"p"},"cmd")," + ",(0,n.kt)("inlineCode",{parentName:"p"},"x"),") your whole serverside code, provide any symbol (like ",(0,n.kt)("inlineCode",{parentName:"p"},"a') to overwrite the cache and replace it back by pasting the code ("),"ctrl",(0,n.kt)("inlineCode",{parentName:"p"},"/"),"cmd",(0,n.kt)("inlineCode",{parentName:"p"},"+"),"v`).")),(0,n.kt)("hr",null),(0,n.kt)("h2",{id:"writing-serverside-code"},"Writing Serverside Code"),(0,n.kt)("p",null,"As mentioned above, when you create a new Web, Serverside or Triggered Campaign Template and view the Serverside Code tab, you will get a concise and simple code snippet:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-ts"},'export class NewTemplate implements CampaignTemplateComponent {\n\n    @title("Example Field")\n    header: string;\n\n    run(context: CampaignComponentContext) {\n        return {};\n    }\n\n}\n')),(0,n.kt)("p",null,"There is a collection of much more complex ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/evergage/evergage-global-templates/tree/master"},"Global Templates available")," that are great starting points for building actual campaigns, but here we will start with the base snippet and build up from it for learning purposes."),(0,n.kt)("p",null,"There are three critical parts of that snippet:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-ts",metastring:"{3-5,7-8,10}","{3-5,7-8,10}":!0},'export class NewTemplate implements CampaignTemplateComponent {\n\n    // 1: field configuraiton\n    @title("Example Field")\n    header: string;\n\n    run(context: CampaignComponentContext) {\n        // 2: run block\n\n        return {}; // 3: return statement\n    }\n}\n')),(0,n.kt)("h3",{id:"1-field-configuration"},"1. Field Configuration"),(0,n.kt)("p",null,"The field configuration lets you add properties that will become part of the campaign configuration form used by marketers to set the experiences. It is the primary data input; MCP will directly pass all properties you add here to the campaign response."),(0,n.kt)(o.z,{link:"../mcp-serverside-code-properties/",text:"Learn more",newTab:"true",mdxType:"Button"}),(0,n.kt)("h3",{id:"2-run-block"},"2. Run Block"),(0,n.kt)("p",null,"Run block has access to the context object containing trigger event details and MC Personalization data. It can also pull information configured in the properties by the marketer. With all of this, you can use it to enrich and transform the data that the campaign will return."),(0,n.kt)("h3",{id:"3-return-statement"},"3. Return Statement"),(0,n.kt)("p",null,"Return statement within the run block lets you add custom properties to the final campaign payload. Whatever you add to the returned object will be available along with the properties from the field configuration section."),(0,n.kt)("admonition",{title:"You Should Know",type:"note"},(0,n.kt)("p",{parentName:"admonition"},"The run block execution works differently during the template creation and campaign configuration. When the marketer configures the campaign, MCP applies the changes executed within the run in real time - this may lead to content changes or even the removal of field input. You shouldn't transform the data in the fields directly but rather do it on new variables:"),(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-ts",metastring:'{8,10} title= "Transform field values using the new variable"',"{8,10}":!0,title:"",'"Transform':!0,field:!0,values:!0,using:!0,the:!0,new:!0,'variable"':!0},'export class PersonalizedOverlay implements CampaignTemplateComponent {\n\n    @title("Personalized Header")\n    @subtitle("Use {firstName} to insert first name personalization")\n    initialHeader: string;\n\n    run(context: CampaignComponentContext) {\n        let header = this.initialHeader.replace(/{firstName}/g, context.user.attributes?.firstName || \'Trailblazer\');\n\n        return { header };\n    }\n}\n')),(0,n.kt)("p",{parentName:"admonition"},"This way, the configured field will stay as it is, but in the final campaign payload, you will also have the transformed variable for use."),(0,n.kt)("p",{parentName:"admonition"},"Keep this in mind when you have to provide a payload according to a specification (e.g. in the Serverside Campaign Template). If you want to make any transformations to a manual input, add some prefix to the property in the field configuration section (e.g. ",(0,n.kt)("inlineCode",{parentName:"p"},"initial"),") and output the expected name only through the return statement of the run block, as shown in the snippet above.")),(0,n.kt)("p",null,"With the basics of Serverside Code processing, you are ready to start coding. Next step - build MCP Campaign Template inputs with ",(0,n.kt)("a",{parentName:"p",href:"../mcp-serverside-code-properties/"},"Serverside Code Properties"),"."),(0,n.kt)("hr",null),(0,n.kt)("h2",{id:"all-mcp-serverside-code-guides"},"All MCP Serverside Code Guides"),(0,n.kt)(s.Z,{mdxType:"DocCardList"}),(0,n.kt)("hr",null),(0,n.kt)("h2",{id:"learn-more"},"Learn more"),(0,n.kt)("p",null,"Here, I want to share a few of my favourite sources focusing on MCP Serverside Code and its use in Campaign Templates:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"My ",(0,n.kt)("a",{parentName:"li",href:"../../category/mc-personalization-snippets/"},"MCP Campaign Templates and code snippets")),(0,n.kt)("li",{parentName:"ol"},"Official ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/evergage/evergage-global-templates/"},"GitHub repository")," with Global Templates"),(0,n.kt)("li",{parentName:"ol"},"Christoper's Long ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/christopher-longSFDC/mcp/"},"GitHub repository")," with Complex Templates"),(0,n.kt)("li",{parentName:"ol"},"Salesforce Japan ",(0,n.kt)("a",{parentName:"li",href:"https://is-template-guide.herokuapp.com/en/"},"Template Catalog")," with Web Campaigns")),(0,n.kt)("p",null,"Found other inspiring MCP Serverside Code examples? Let me know!"))}C.isMDXComponent=!0}}]);