"use strict";(self.webpackChunkmd=self.webpackChunkmd||[]).push([[6327],{4137:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),p=c(n),m=o,h=p["".concat(s,".").concat(m)]||p[m]||u[m]||i;return n?a.createElement(h,l(l({ref:t},d),{},{components:n})):a.createElement(h,l({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,l=new Array(i);l[0]=p;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r.mdxType="string"==typeof e?e:o,l[1]=r;for(var c=2;c<i;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},1872:(e,t,n)=>{n.d(t,{m:()=>i});var a=n(7294);const o="leadText_qzwo",i=e=>{let{content:t}=e;return a.createElement(a.Fragment,null,a.createElement("p",{id:o},t))}},2311:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>d});var a=n(7462),o=(n(7294),n(4137)),i=n(1872);const l={id:"sfmc-contact-deletion",title:"SFMC Contact Deletion",sidebar_label:"Contact Deletion Process",description:"Marketing Automation is as powerful as the database quality behind it. To make it good you must first remove the bad. Let's do it.",image:"img/og/og-image-sfmc-contact-deletion.png",tags:["Marketing Cloud","Snippet","SSJS","SQL","Data Extensions","Data Management"],toc_max_heading_level:4},r=void 0,s={unversionedId:"usecase/sfmc-contact-deletion",id:"usecase/sfmc-contact-deletion",title:"SFMC Contact Deletion",description:"Marketing Automation is as powerful as the database quality behind it. To make it good you must first remove the bad. Let's do it.",source:"@site/docs/usecase/sfmc-contact-deletion.mdx",sourceDirName:"usecase",slug:"/usecase/sfmc-contact-deletion",permalink:"/docs/usecase/sfmc-contact-deletion",draft:!1,editUrl:"https://github.com/MateuszDabrowski/mateuszdabrowski.pl/edit/master/docs/usecase/sfmc-contact-deletion.mdx",tags:[{label:"Marketing Cloud",permalink:"/docs/tags/marketing-cloud"},{label:"Snippet",permalink:"/docs/tags/snippet"},{label:"SSJS",permalink:"/docs/tags/ssjs"},{label:"SQL",permalink:"/docs/tags/sql"},{label:"Data Extensions",permalink:"/docs/tags/data-extensions"},{label:"Data Management",permalink:"/docs/tags/data-management"}],version:"current",lastUpdatedBy:"Mateusz D\u0105browski",lastUpdatedAt:1665430773,formattedLastUpdatedAt:"Oct 10, 2022",frontMatter:{id:"sfmc-contact-deletion",title:"SFMC Contact Deletion",sidebar_label:"Contact Deletion Process",description:"Marketing Automation is as powerful as the database quality behind it. To make it good you must first remove the bad. Let's do it.",image:"img/og/og-image-sfmc-contact-deletion.png",tags:["Marketing Cloud","Snippet","SSJS","SQL","Data Extensions","Data Management"],toc_max_heading_level:4},sidebar:"snippets",previous:{title:"Enhanced Send Log",permalink:"/docs/usecase/sfmc-enhanced-send-log"},next:{title:"SFMC Webinars",permalink:"/docs/sfmc-webinars"}},c={},d=[{value:"Outline",id:"outline",level:2},{value:"Contact Deletion in SFMC",id:"contact-deletion-in-sfmc",level:2},{value:"Enable Contact Deletion",id:"enable-contact-deletion",level:3},{value:"Manual Contact Deletion",id:"manual-contact-deletion",level:3},{value:"Delete contacts from All Contacts",id:"delete-contacts-from-all-contacts",level:4},{value:"Delete all contacts from List or Data Extension",id:"delete-all-contacts-from-list-or-data-extension",level:4},{value:"SFMC API Contact Deletion",id:"sfmc-api-contact-deletion",level:3},{value:"Contact Deletion by Contact ID",id:"contact-deletion-by-contact-id",level:4},{value:"Contact Deletion by Contact Key",id:"contact-deletion-by-contact-key",level:4},{value:"Contact Deletion using Data Extension",id:"contact-deletion-using-data-extension",level:4},{value:"Contact Deletion with Automation Studio",id:"contact-deletion-with-automation-studio",level:3},{value:"Contact Deletion Pending Data Extension",id:"contact-deletion-pending-data-extension",level:4},{value:"Contact Deletion Script Activity",id:"contact-deletion-script-activity",level:4},{value:"Monitor Contact Deletion Process",id:"monitor-contact-deletion-process",level:3},{value:"Which contacts should you delete?",id:"which-contacts-should-you-delete",level:2},{value:"Contacts deleted in Salesforce CRM",id:"contacts-deleted-in-salesforce-crm",level:3},{value:"Leads and Users deleted or filtered in Salesforce CRM",id:"leads-and-users-deleted-or-filtered-in-salesforce-crm",level:3},{value:"Contactless Contacts",id:"contactless-contacts",level:3},{value:"Zombie Contacts",id:"zombie-contacts",level:3},{value:"Contact Deletion Archive",id:"contact-deletion-archive",level:2},{value:"Contact Deletion Archive Data Extension",id:"contact-deletion-archive-data-extension",level:3},{value:"Contact Deletion Archive Query Activity",id:"contact-deletion-archive-query-activity",level:3}],u={toc:d};function p(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)(i.m,{content:"Marketing Automation is as powerful as the database quality behind it. To make it good you must first remove the bad. Let's do it.",mdxType:"LeadText"}),(0,o.kt)("h2",{id:"outline"},"Outline"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"#contact-deletion-in-sfmc"},"Learn everything about SFMC Contact Deletion Process")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"#which-contacts-should-you-delete"},"Check out sample segments just waiting to be deleted")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"#contact-deletion-archive"},"Create privacy-focused Contact Deletion Archive"))),(0,o.kt)("h2",{id:"contact-deletion-in-sfmc"},"Contact Deletion in SFMC"),(0,o.kt)("p",null,"Salesforce Marketing Cloud makes Contact Deletion not only easy but also powerful. The out-of-the-box solution does most of the heavy lifting, leaving us the decision of who and when should be deleted from our platform."),(0,o.kt)("p",null,"But before we start the cleanup, let's see why we should do it in the first place. It's not easy to get new opted-in Contacts, so we shouldn't take removal lightly. However, there are multiple good reasons to do that:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Compliance"),": Many legal systems (like European GDPR) allow subscribers to request contact deletion."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Licensing"),": A marketing Cloud licence allows you to store a limited number of Contacts."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Performance"),": The more Contacts you have, the slower will be your Journeys and Automations."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Cost"),": Sending to dead Contacts means burning SuperMessages without any value in return."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Deliverability"),": Sending to dead or bad quality Contacts hurts your email deliverability and inbox placement."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Analytics"),": Bad quality data negatively impacts the quality of your analytics, making it harder to make the right decisions.")),(0,o.kt)("p",null,"Once we know why we should delete, it's time to see what exactly is the built-in SFMC Contact Deletion process doing behind the scenes:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"It manages ",(0,o.kt)("strong",{parentName:"li"},"supression period for contacts")," requested for deletion:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Suppression in ",(0,o.kt)("strong",{parentName:"li"},"Contact Builder")," hides the contacts and blocks the possibility to create a new one with the same Contact Key."),(0,o.kt)("li",{parentName:"ul"},"Suppression in ",(0,o.kt)("strong",{parentName:"li"},"Email Studio")," hides the contacts and blocks them from receiving Emails or interacting with Triggered Sends."),(0,o.kt)("li",{parentName:"ul"},"Suppression in ",(0,o.kt)("strong",{parentName:"li"},"Journey Builder")," blocks the contacts from entering Journeys and Automations."),(0,o.kt)("li",{parentName:"ul"},"Suppression in ",(0,o.kt)("strong",{parentName:"li"},"Mobile Studio")," (MobileConnect, MobilePush, GroupConnect) hides the contacts and blocks them from receiving any communication and doing any interactions (exception - block requests are still processed)."),(0,o.kt)("li",{parentName:"ul"},"Suppression in ",(0,o.kt)("strong",{parentName:"li"},"Einstein")," hides the contacts and blocks both Recommendations and Analytics."))),(0,o.kt)("li",{parentName:"ol"},"After the suppression period, it ",(0,o.kt)("strong",{parentName:"li"},"deletes contacts")," from:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Sendable Data Extensions"),(0,o.kt)("li",{parentName:"ul"},"Populations"),(0,o.kt)("li",{parentName:"ul"},"Lists"),(0,o.kt)("li",{parentName:"ul"},"Groups"),(0,o.kt)("li",{parentName:"ul"},"Journeys"),(0,o.kt)("li",{parentName:"ul"},"Automations"),(0,o.kt)("li",{parentName:"ul"},"Einstein")))),(0,o.kt)("p",null,"As you can see, a lot out-of-the-box. But what is the purpose of the suppression period when we just want to delete some contacts?"),(0,o.kt)("p",null,"Contact Deletion is irreversible. Once we remove the contact, it is deleted for good, and there is no option to bring it back. Sure, you can add it again, but it won't have any past data. So, if you are not confident in your Contact Deletion process, you might ",(0,o.kt)("a",{parentName:"p",href:"#enable-contact-deletion"},"configure suppression period")," to have some time for reflection. That's why it is there by default (currently at two days). If you find a mistake during that period, put a Support ticket as soon as possible with high priority."),(0,o.kt)("p",null,"There is also a second reason for the suppression period. Depending on the parallel processes run in your Marketing Cloud, the number of contacts requested for deletion, as well as the volume of data in the system, SFMC Contact Deletion can be a very time-consuming process. Suppression makes sure that even if it takes longer than you would like, the Contact will not get any unwanted communication."),(0,o.kt)("admonition",{title:"You Should Know",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Few places are not targeted by the out-of-the-box Marketing Cloud Contact Deletion process:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},"Non-Sendable Data Extensions \xbb ",(0,o.kt)("em",{parentName:"li"},"Can be removed with either retention or heavy custom scripting")),(0,o.kt)("li",{parentName:"ul"},"Synchronized Data Extensions \xbb ",(0,o.kt)("em",{parentName:"li"},"Can be removed in the source system")),(0,o.kt)("li",{parentName:"ul"},"Triggered Send Lists \xbb ",(0,o.kt)("em",{parentName:"li"},"Can be removed using ",(0,o.kt)("a",{parentName:"em",href:"#sfmc-api-contact-deletion"},"API method")))),(0,o.kt)("p",{parentName:"admonition"},"It also ignores any data that is not connected to the deleted contact by Contact Key / Subscriber Key / Contact ID, so be sure to have a proper deduplication process in place for compliance.")),(0,o.kt)("h3",{id:"enable-contact-deletion"},"Enable Contact Deletion"),(0,o.kt)("p",null,"To use the Contact Deletion Process in Salesforce Marketing Cloud, you must enable it first. To do this, you need to have a Marketing Cloud Administrator role."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Go to parent Business Unit."),(0,o.kt)("li",{parentName:"ol"},"Go to Audience Builder \xbb Contact Builder."),(0,o.kt)("li",{parentName:"ol"},"Click Contacts Configuration in the top menu."),(0,o.kt)("li",{parentName:"ol"},"Enable the process in the Contact Delete section."),(0,o.kt)("li",{parentName:"ol"},"Configure suppression period by clicking Manage Settings (default is two days)."),(0,o.kt)("li",{parentName:"ol"},"Save.")),(0,o.kt)("p",null,"If you want the Contact Deletion process to trigger automatically after starting it, set the suppression period to 0 days. It will be added to the processing queue instantly after the request."),(0,o.kt)("admonition",{title:"You Should Know",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"For the most popular SFMC tenant type - Enterprise 2.0 - the deletion must happen at the parent level and automatically apply across all Business Units."),(0,o.kt)("p",{parentName:"admonition"},"If you have a different tenant type, check the official ",(0,o.kt)("a",{parentName:"p",href:"https://help.salesforce.com/s/articleView?id=sf.mc_cab_contact_deletion.htm&type=5"},"documentation"),".")),(0,o.kt)("h3",{id:"manual-contact-deletion"},"Manual Contact Deletion"),(0,o.kt)("p",null,"Once the Contact Deletion is ",(0,o.kt)("a",{parentName:"p",href:"#enable-contact-deletion"},"enabled and configured"),", you can start cleaning. The easiest way is to leverage manual deletion options available in the Contact Builder."),(0,o.kt)("admonition",{title:"You Should Know",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Manual Contact Deletion in Email Studio will remove the contact only from Email Studio. To trigger the Contact Deletion Process, you must leverage Contact Builder or ",(0,o.kt)("a",{parentName:"p",href:"#sfmc-api-contact-deletion"},"API method"),".")),(0,o.kt)("h4",{id:"delete-contacts-from-all-contacts"},"Delete contacts from All Contacts"),(0,o.kt)("p",null,"This method is best if you have just a few contacts you want to delete. It's simple, it's fast, it's constrained."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Go to parent Business Unit."),(0,o.kt)("li",{parentName:"ol"},"Go to Audience Builder \xbb Contact Builder."),(0,o.kt)("li",{parentName:"ol"},"Click All Contacts in the top menu."),(0,o.kt)("li",{parentName:"ol"},"Find a contact(s) you want to delete and click checkboxes next to them."),(0,o.kt)("li",{parentName:"ol"},"Click the trash icon and select Delete selected contacts.")),(0,o.kt)("p",null,"Using this method, you can delete multiple contacts, but only from a single page of results. If you navigate to the next page of results, previously checked contacts will no longer be part of your selection."),(0,o.kt)("p",null,"If you want to remove more contacts, leverage the Data Extension method shared below."),(0,o.kt)("h4",{id:"delete-all-contacts-from-list-or-data-extension"},"Delete all contacts from List or Data Extension"),(0,o.kt)("p",null,"This method will be better if you want to remove a significant number of contacts once but don't want the hassle of the most potent ",(0,o.kt)("a",{parentName:"p",href:"#sfmc-api-contact-deletion"},"API method"),"."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Go to parent Business Unit."),(0,o.kt)("li",{parentName:"ol"},"Go to Audience Builder \xbb Contact Builder."),(0,o.kt)("li",{parentName:"ol"},"Click All Contacts in the top menu."),(0,o.kt)("li",{parentName:"ol"},"Without selecting any contact, click the trash icon."),(0,o.kt)("li",{parentName:"ol"},"Click Delete contacts from list / data extension depending on your needs."),(0,o.kt)("li",{parentName:"ol"},"Select the Sendable Data Extension used for the Contact Deletion process."),(0,o.kt)("li",{parentName:"ol"},"Decide whether the Data Extension itself should stay in the system after SFMC deletes the contacts."),(0,o.kt)("li",{parentName:"ol"},"Click Delete Contacts."),(0,o.kt)("li",{parentName:"ol"},"Review and confirm by clicking Delete.")),(0,o.kt)("admonition",{title:"You Should Know",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"This method allows you to delete up to one million contacts per operation. If you want to remove more than that, you will have to run the above steps multiple times or leverage ","[contact deletion automation]","(#contact-deletion-with-automation Studio).")),(0,o.kt)("h3",{id:"sfmc-api-contact-deletion"},"SFMC API Contact Deletion"),(0,o.kt)("p",null,"Previous methods are nice, but they require manual triggering in the Salesforce Marketing cloud each time you run the Contact Deletion Process. There are, however, many use cases where you might want to trigger it automatically - for example, from a different system responsible for managing privacy."),(0,o.kt)("p",null,"Thankfully, SFMC offers a solution for that as well with REST API. To implement it:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Create authentication endpoint with correct permissions with Installed Package",(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"Go to Setup in Parent Business Unit."),(0,o.kt)("li",{parentName:"ol"},"Within the Platform Tools section, roll out Apps and click Installed Packages."),(0,o.kt)("li",{parentName:"ol"},"Click New in the top right."),(0,o.kt)("li",{parentName:"ol"},"Provide a meaningful name and description for your Installed Package."),(0,o.kt)("li",{parentName:"ol"},"Add Component - API Integration."),(0,o.kt)("li",{parentName:"ol"},"Select the Server-to-Server integration type."),(0,o.kt)("li",{parentName:"ol"},"Select Read and Write for List and Subscribers within the Contacts section. Write is needed for Deletion. Read - for checking the deletion status."),(0,o.kt)("li",{parentName:"ol"},"Click Save."))),(0,o.kt)("li",{parentName:"ol"},"Copy Client Id, Client Secret and Client Base (the unique string in either of the API URIs that is between ",(0,o.kt)("inlineCode",{parentName:"li"},"https://")," and API type)."),(0,o.kt)("li",{parentName:"ol"},"Leverage the contact deletion endpoint in the solution of your choice: ",(0,o.kt)("inlineCode",{parentName:"li"},"https://CLIENT_BASE.rest.marketingcloudapis.com/contacts/v1/contacts/actions/delete"),".")),(0,o.kt)("p",null,"This single endpoint will allow you to trigger the Contact Deletion process in three ways by adding a query string at the end. All scenarios will use the same Method, Content-Type and Authorization, but the endpoint and payload will be different:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Method: POST"),(0,o.kt)("li",{parentName:"ul"},"Content-Type: application/json"),(0,o.kt)("li",{parentName:"ul"},"Authorization: Bearer TOKEN")),(0,o.kt)("h4",{id:"contact-deletion-by-contact-id"},"Contact Deletion by Contact ID"),(0,o.kt)("p",null,"Endpoint: ",(0,o.kt)("inlineCode",{parentName:"p"},"https://CLIENT_BASE.rest.marketingcloudapis.com/contacts/v1/contacts/actions/delete?type=ids")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Delete by Contact ID Payload"',title:'"Delete',by:!0,Contact:!0,ID:!0,'Payload"':!0},'{\n    "values": [1111111, 22222222],\n    "deleteOperationType": "ContactAndAttributes"\n}\n')),(0,o.kt)("p",null,"This endpoint's ",(0,o.kt)("inlineCode",{parentName:"p"},"values")," is an array of Contact IDs (integers)."),(0,o.kt)("h4",{id:"contact-deletion-by-contact-key"},"Contact Deletion by Contact Key"),(0,o.kt)("p",null,"Endpoint: ",(0,o.kt)("inlineCode",{parentName:"p"},"https://CLIENT_BASE.rest.marketingcloudapis.com/contacts/v1/contacts/actions/delete?type=keys")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Delete by Contact Key Payload"',title:'"Delete',by:!0,Contact:!0,Key:!0,'Payload"':!0},'{\n    "values": ["A1B2C3D4", "E5F6G7H8"],\n    "deleteOperationType": "ContactAndAttributes"\n}\n')),(0,o.kt)("p",null,"This endpoint's ",(0,o.kt)("inlineCode",{parentName:"p"},"values")," is an array of Contact Keys (strings)."),(0,o.kt)("h4",{id:"contact-deletion-using-data-extension"},"Contact Deletion using Data Extension"),(0,o.kt)("p",null,"Endpoint: ",(0,o.kt)("inlineCode",{parentName:"p"},"https://CLIENT_BASE.rest.marketingcloudapis.com/contacts/v1/contacts/actions/delete?type=listReference")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Delete using Data Extension Payload"',title:'"Delete',using:!0,Data:!0,Extension:!0,'Payload"':!0},'{\n    "deleteOperationType": "ContactAndAttributes",\n    "targetList": {\n        "listType": { "listTypeID": 3 },\n        "listKey": "contactDeletionDEKey"\n    },\n    "deleteListWhenCompleted": false,\n    "deleteListContentsWhenCompleted": true\n}\n')),(0,o.kt)("p",null,"In this endpoint, you have control over three values:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"listKey"),": the external key of the Data Extension you use for the Contact Deletion process."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"deleteListWhenCompleted"),": when ",(0,o.kt)("inlineCode",{parentName:"li"},"true"),", it will delete the Data Extension during the Contact Deletion process."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"deleteListContentsWhenCompleted"),": when ",(0,o.kt)("inlineCode",{parentName:"li"},"true")," it will delete records from the Data Extensions during Contact Deletion process.")),(0,o.kt)("h3",{id:"contact-deletion-with-automation-studio"},"Contact Deletion with Automation Studio"),(0,o.kt)("p",null,"With the ",(0,o.kt)("a",{parentName:"p",href:"#sfmc-api-contact-deletion"},"API Contact Deletion")," we are not limited to external triggers. We can also leverage AMPScript or SSJS to trigger it directly from Marketing Cloud."),(0,o.kt)("p",null,"The most popular use case is a Contact Deletion Automation scheduled to clean up the database regularly. It's a great idea to keep your SFMC instance clean without much of a hassle."),(0,o.kt)("p",null,"My recommended approach is to create a dedicated Pending Contact Deletion Shared Data Extension that will store records to be deleted along with some context and remove its content nightly with the Script Activity."),(0,o.kt)("h4",{id:"contact-deletion-pending-data-extension"},"Contact Deletion Pending Data Extension"),(0,o.kt)("p",null,"If you want to capture contacts-to-be-deleted from multiple Business Units, make it Shared Data Extension."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Name"),(0,o.kt)("th",{parentName:"tr",align:null},"DataType"),(0,o.kt)("th",{parentName:"tr",align:null},"Default Value"),(0,o.kt)("th",{parentName:"tr",align:null},"Length"),(0,o.kt)("th",{parentName:"tr",align:null},"Nullable"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"\ud83d\udd11 SubscriberKey"),(0,o.kt)("td",{parentName:"tr",align:null},"Text"),(0,o.kt)("td",{parentName:"tr",align:null}),(0,o.kt)("td",{parentName:"tr",align:null},"18"),(0,o.kt)("td",{parentName:"tr",align:null},"No")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"DeletionReason"),(0,o.kt)("td",{parentName:"tr",align:null},"Text"),(0,o.kt)("td",{parentName:"tr",align:null}),(0,o.kt)("td",{parentName:"tr",align:null},"50"),(0,o.kt)("td",{parentName:"tr",align:null},"Yes")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"DeletionDate"),(0,o.kt)("td",{parentName:"tr",align:null},"Date"),(0,o.kt)("td",{parentName:"tr",align:null},"Current date"),(0,o.kt)("td",{parentName:"tr",align:null}),(0,o.kt)("td",{parentName:"tr",align:null},"Yes")))),(0,o.kt)("p",null,"External Key: ",(0,o.kt)("inlineCode",{parentName:"p"},"contact-deletion-pending-de"),"\nSendable: ",(0,o.kt)("inlineCode",{parentName:"p"},"true")),(0,o.kt)("p",null,"You don't need anything but the Subscriber Key for essential contact deletion. However, I prefer to add a bit more context that I can leverage in the ",(0,o.kt)("a",{parentName:"p",href:"#contact-deletion-archive"},"Contact Deletion archive")," described later in this article."),(0,o.kt)("h4",{id:"contact-deletion-script-activity"},"Contact Deletion Script Activity"),(0,o.kt)("p",null,"Below you can find ready-to-use SSJS snippet for Script Activity. Change ",(0,o.kt)("inlineCode",{parentName:"p"},"clietnSecret"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"clientID")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"clientBase")," variables to data you saved during ",(0,o.kt)("a",{parentName:"p",href:"#sfmc-api-contact-deletion"},"Installed Package configuration"),". If needed, change also the ",(0,o.kt)("inlineCode",{parentName:"p"},"contactDeletionDEKey"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"errorDE")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"automationName")," variables to reflect your configuration."),(0,o.kt)("p",null,"To learn more about ",(0,o.kt)("inlineCode",{parentName:"p"},"errorDE")," check my ",(0,o.kt)("a",{parentName:"p",href:"/docs/ssjs/debugging-ssjs#error-logging"},"debugging guide"),". You will find there also details about ",(0,o.kt)("a",{parentName:"p",href:"/docs/ssjs/debugging-ssjs#error-handler-function"},"helper functions")," from the script."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html",metastring:'title="Contact Deletion Script Activity SSJS Snippet"',title:'"Contact',Deletion:!0,Script:!0,Activity:!0,SSJS:!0,'Snippet"':!0},"<script runat=\"server\">\n    Platform.Load('core', '1')\n\n    /* -------------------------------------------------------------------------\n\n        1. Global Variables\n            1.1. Contact Deletion DE Key\n            1.2. REST API Authorization\n            1.3. Error Handling\n        2. Helper Functions\n            2.1. Debugging\n            2.2. Error handling\n        3. Main Script\n            3.1. REST API Authorization\n            3.2. Contact Deletion Process\n\n    -------------------------------------------------------------------------- */\n\n    /* ----------------------------------------------------------------------- */\n    /* ------------------------- 1. GLOBAL VARIABLES ------------------------- */\n    /* ----------------------------------------------------------------------- */\n\n    /* ------------------------ 1.1 Contact Deletion DE Key -------------------------- */\n\n    var contactDeletionDEKey = 'contact-deletion-pending-de';\n\n    /* ------------------------ 1.2 REST API Authorization --------------------------- */\n\n    var payload, endpoint, response;\n\n    var clientSecret = 'clientSecretFromInstalledPackage';\n    var clientID = 'clientIDFromInstalledPackage';\n    var clientBase = 'clientBaseUrl'\n    var contentType = 'application/json';\n    var debugging = false;\n\n\n    /* ------------------------ 1.3 Error Handling --------------------------- */\n\n    var errorDE = 'error-log-de';\n    var automationName = 'contact-deletion-process';\n\n\n    /* ----------------------------------------------------------------------- */\n    /* ------------------------- 2. HELPER FUNCTIONS ------------------------- */\n    /* ----------------------------------------------------------------------- */\n\n    /* --------------------------- 2.1. Debugging ---------------------------- */\n\n    /**\n     * @function debugValue\n     * @description Outputs provided description and SSJS value to front-end in a type-safe & consistent way\n     * @param {string} description - Describes meaning of the second parameter in the output\n     * @param {*} value - The value that needs to be debugged\n     */\n    function debugValue(description, value) {\n        Write(description + ': ' + (typeof value == 'object' ? Stringify(value) : value) + '<br><br>');\n    };\n\n    /* -------------------------- 2.2. Error handling ------------------------ */\n\n    /**\n     * @function handleError\n     * @description Adds the error with context to error logging Data Extension and redirects to an error page.\n     * @param {Object} error - The caught error object. It can come from the try/catch block or be manually created.\n     * @param {string} error.message - First error key stores a short error message describing the issue.\n     * @param {string} error.description - Second error key stores detailed error path helping with root cause analysis\n     */\n    function handleError(error) {\n        if (debugging) {\n            debugValue('Found error', error);\n        } else {\n            Platform.Function.InsertData(errorDE, ['ID', 'ErrorSource', 'ErrorMessage', 'ErrorDescription'], [GUID(), automationName, error.message, error.description]);\n        };\n    };\n\n\n    /* ----------------------------------------------------------------------- */\n    /* --------------------------- 3. MAIN SCRIPT ---------------------------- */\n    /* ----------------------------------------------------------------------- */\n\n    /* ------------------- 3.1. REST API Authorization --------------------- */\n\n    endpoint = 'https://' + clientBase + '.auth.marketingcloudapis.com/v2/token';\n    payload = {\n        client_id: clientID,\n        client_secret: clientSecret,\n        grant_type: 'client_credentials'\n    };\n    if (debugging) debugValue('Payload', payload);\n\n    try {\n        response = HTTP.Post(endpoint, contentType, Stringify(payload));\n    } catch (error) {\n        handleError(error);\n    }\n    var accessToken = Platform.Function.ParseJSON(response['Response'][0]).access_token;\n    if (debugging) debugValue('AccessToken', accessToken);\n\n    /* ------------------- 3.2. Contact Deletion Process --------------------- */\n\n    endpoint = 'https://' + clientBase + '.rest.marketingcloudapis.com/contacts/v1/contacts/actions/delete?type=listReference';\n    payload = {\n        deleteOperationType: 'ContactAndAttributes',\n        targetList: {\n            listType: { listTypeID: 3 },\n            listKey: contactDeletionDEKey\n        },\n        deleteListWhenCompleted: false,\n        deleteListContentsWhenCompleted: true\n    };\n    var headerNames = ['Authorization'];\n    var headerValues = ['Bearer ' + accessToken];\n\n    try {\n        response = HTTP.Post(endpoint, contentType, Stringify(payload), headerNames, headerValues);\n        if (debugging) debugValue('Response', response);\n    } catch (error) {\n        handleError(error);\n    }\n<\/script>\n")),(0,o.kt)("h3",{id:"monitor-contact-deletion-process"},"Monitor Contact Deletion Process"),(0,o.kt)("p",null,"There are three ways to monitor what is happening with your Contact Deletion requests (you should perform all three from the parent Business Unit):"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"In Contact Builder, in the top menu, click All Contacts. Click the trash icon in the top right, and select ",(0,o.kt)("strong",{parentName:"li"},"View Pending Deletions"),"."),(0,o.kt)("li",{parentName:"ol"},"In Contact Builder, in the top menu, click Contact Analytics. You will see a full ",(0,o.kt)("strong",{parentName:"li"},"Contact Deletion Dashboard"),"."),(0,o.kt)("li",{parentName:"ol"},"Request details using ",(0,o.kt)("a",{parentName:"li",href:"https://developer.salesforce.com/docs/marketing/marketing-cloud/guide/ContactsDeleteRequestsDetails.html"},(0,o.kt)("strong",{parentName:"a"},"Contact Deletion Details API")),".")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"which-contacts-should-you-delete"},"Which contacts should you delete?"),(0,o.kt)("p",null,"You should always align this question with the specific business needs of your company. However, there are some very popular segments that may inspire you."),(0,o.kt)("p",null,"You can add them within the same Automation as the ",(0,o.kt)("a",{parentName:"p",href:"#contact-deletion-script-activity"},"Contact Deletion Script Activity")," to ensure they are captured right before cleanup. You may also create separate Automations on your child Business Unit to capture BU-specific candidates for cleanup using data available only there."),(0,o.kt)("p",null,"Remember to test those recommendations and queries (for example, using ",(0,o.kt)("a",{parentName:"p",href:"/docs/sql/sfmc-sql-basics#query-studio"},"Query Studio"),") before implementing them in your Contact Deletion Process, as even a small mistake might lead to irreversible data loss."),(0,o.kt)("h3",{id:"contacts-deleted-in-salesforce-crm"},"Contacts deleted in Salesforce CRM"),(0,o.kt)("p",null,"If you use Marketing Cloud Connect to integrate your Salesforce CRM with the Marketing Cloud, you should think about synchronizing deletions between those two systems. It does not happen automatically. By default, contacts deleted in SF CRM are removed from Synchronized Data Extensions and stay in other Marketing Cloud tables."),(0,o.kt)("p",null,"You can, however, add this using Query Activity in Automation Studio. For the email channel, it's straightforward:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="Find subscribers deleted in SF CRM"',title:'"Find',subscribers:!0,deleted:!0,in:!0,SF:!0,'CRM"':!0},"SELECT\n      subscriber.SubscriberKey\n    , 'Deleted in SF CRM'       AS DeletionReason\nFROM _Subscribers                   AS subscriber\n    LEFT JOIN Contact_Salesforce    AS contact\n        ON contact.Id = subscriber.SubscriberKey\nWHERE contact.Id IS NULL\n")),(0,o.kt)("p",null,"If you are also using other channels, you can include their ",(0,o.kt)("a",{parentName:"p",href:"/docs/config/sfmc-config-system-data-views"},"System Data Views")," to the query."),(0,o.kt)("h3",{id:"leads-and-users-deleted-or-filtered-in-salesforce-crm"},"Leads and Users deleted or filtered in Salesforce CRM"),(0,o.kt)("p",null,"This method is also great for removing deleted or unused records from other objects counted against your All Contacts licence limits - Leads and Users. There are two caveats, however."),(0,o.kt)("p",null,"First, to remove unused Leads and Users, you must first stop them from synchronizing via Marketing Cloud Connect. Otherwise, they will come back to SFMC at the next scheduled synchronization. The best way to do it is to create a boolean field on those objects (for example, ",(0,o.kt)("inlineCode",{parentName:"p"},"ShouldSyncToSFMC"),") that would be ",(0,o.kt)("inlineCode",{parentName:"p"},"true")," only for records you need in your system. Depending on your use case, it might be neither (so just set ",(0,o.kt)("inlineCode",{parentName:"p"},"false")," as the default value), or it might be complicated (the calculated field will be your best friend). With such a boolean, you will be able to select it as a filter for your Marketing Cloud Connect object synchronization."),(0,o.kt)("p",null,"Second is the problem of finding those records in the Marketing Cloud. The easy way is to create a copy of Synchronized Data Extensions before filtering them. However, this will not always be possible, and it won't capture Leads and Users that were removed in the past from CRM."),(0,o.kt)("p",null,"If you have Mobile Studio in your SFMC licence, you have a nice workaround:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Go to Contact Builder."),(0,o.kt)("li",{parentName:"ol"},"Click All Contacts in the top menu."),(0,o.kt)("li",{parentName:"ol"},"Select the Mobile List tab."),(0,o.kt)("li",{parentName:"ol"},"Click Create Mobile List button in the top right."),(0,o.kt)("li",{parentName:"ol"},"Leave MobileConnect as the channel and select Filtered List as a type. Click Ok."),(0,o.kt)("li",{parentName:"ol"},"Select All Contacts and click Select."),(0,o.kt)("li",{parentName:"ol"},"Remove prepopulated Mobile Number filter and on the left pane select System Data \xbb Contact."),(0,o.kt)("li",{parentName:"ol"},"Drag and drop Contact Key and configure it to ",(0,o.kt)("inlineCode",{parentName:"li"},"is not null"),". Click Done."),(0,o.kt)("li",{parentName:"ol"},"Click the Save as Filter button in the top right."),(0,o.kt)("li",{parentName:"ol"},'Provide a sensible name (like "AllContactsList") and click Save.')),(0,o.kt)("admonition",{title:"You Should Know",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"All Contacts view shows many cool data fields, but unfortunately, most are no longer available after the export to the List."),(0,o.kt)("p",{parentName:"admonition"},"Mobile List fields are: ",(0,o.kt)("inlineCode",{parentName:"p"},"SubscriberKey"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"CustomerKey"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"AudienceID"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"TrackingCode"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"AudienceCode"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"SegmentCode"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"SegmentName"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"Priority"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"SegmentID"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"SplitID"),"."),(0,o.kt)("p",{parentName:"admonition"},"So in nearly every case you will have to take the Subscriber Key and enrich it with ",(0,o.kt)("a",{parentName:"p",href:"/docs/sql/sfmc-sql-join"},(0,o.kt)("inlineCode",{parentName:"a"},"JOIN"))," to other more interesting Data Extensions or ",(0,o.kt)("a",{parentName:"p",href:"/docs/config/sfmc-config-system-data-views"},"System Data Views"),".")),(0,o.kt)("p",null,"It will create and populate the list with all your Contacts. Save its name - it will be helpful for the Query."),(0,o.kt)("p",null,"If you want to remove all Leads and Users, you will need only this List:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="Find all Users and Leads"',title:'"Find',all:!0,Users:!0,and:!0,'Leads"':!0},"SELECT SubscriberKey\nFROM AllContactsList\nWHERE\n    SubscriberKey LIKE '005%'\n    OR SubscriberKey LIKE '00Q%'\n")),(0,o.kt)("admonition",{title:"You Should Know",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"You might wonder what is happening within the ",(0,o.kt)("a",{parentName:"p",href:"/docs/sql/sfmc-sql-where"},(0,o.kt)("inlineCode",{parentName:"a"},"WHERE"))," filter above - this is magic that is possible thanks to Salesforce ID structure. The ID is not entirely random. Instead, it has a specific format."),(0,o.kt)("p",{parentName:"admonition"},"For our need here, the key is the three-character prefix that point to a specific Salesforce Object:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},"001 = Account"),(0,o.kt)("li",{parentName:"ul"},"003 = Contact"),(0,o.kt)("li",{parentName:"ul"},"005 = User"),(0,o.kt)("li",{parentName:"ul"},"00Q = Lead")),(0,o.kt)("p",{parentName:"admonition"},"For the complete list, check ",(0,o.kt)("a",{parentName:"p",href:"http://www.fishofprey.com/2011/09/obscure-salesforce-object-key-prefixes.html"},"Daniel Ballinger's cheat sheet"),".")),(0,o.kt)("p",null,"If you want to remove only those Leads / Users that you no longer synchronize via filtered Marketing Cloud Connect, you will need to add a comparison similar to the Contacts use case."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="Find all Users and Leads that are no longer synchronized to SFMC"',title:'"Find',all:!0,Users:!0,and:!0,Leads:!0,that:!0,are:!0,no:!0,longer:!0,synchronized:!0,to:!0,'SFMC"':!0},"SELECT contact.SubscriberKey\nFROM AllContactsList                    AS contact\n    LEFT JOIN Leads_Salesforce          AS lead\n        ON contact.SubscriberKey = lead.ID\n    LEFT JOIN Users_Salesforce          AS user\n        ON contact.SubscriberKey = user.ID\nWHERE\n    (\n        SubscriberKey LIKE '005%'\n        AND user.ID IS NULL\n    )\n    OR\n    (\n        SubscriberKey LIKE '00Q%'\n        AND lead.ID IS NULL\n    )\n")),(0,o.kt)("h3",{id:"contactless-contacts"},"Contactless Contacts"),(0,o.kt)("p",null,"Another group ripe for deletion are Contacts that you cannot contact. Multiple subgroups fill that definition:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Suppressed contacts"),(0,o.kt)("li",{parentName:"ol"},"Hard bounced contacts"),(0,o.kt)("li",{parentName:"ol"},"Contacts that do not have any channel information (like an email address or mobile phone)"),(0,o.kt)("li",{parentName:"ol"},"Bad quality contacts (test records, fake emails, contacts that failed Email Studio List Detective)")),(0,o.kt)("p",null,"Before deletion, it might be worth saving some of this data for the future (especially suppressed contacts for compliance or hard bounced contacts for future deliverability)."),(0,o.kt)("h3",{id:"zombie-contacts"},"Zombie Contacts"),(0,o.kt)("p",null,"Apart from contactless contacts, there are always some zombies in each database. Contacts that you can contact - and you do - but they are not reacting in any way. No opens, no clicks, for months."),(0,o.kt)("p",null,"I know it might be hard to delete opted-in contacts when obtaining new ones is hard work, but you need to finish this toxic relationship after some time. Zombie contacts skew your analytics, put unnecessary strain on your instance, degrade your IP Reputation and create costs without providing any value to your business in return. You will be far better without them."),(0,o.kt)("p",null,"Align with your business the threshold for marking a contact as a zombie. It will be different from company to company, but my starting point recommendation is a contact that (1) Was sent at least six emails, (2) within at least three different months and (3) did not open or click any email."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Makes sure that you tried enough times to make your opinion based on solid facts"),(0,o.kt)("li",{parentName:"ol"},"Makes sure that it's not a matter of out-of-office period, but a constant issue"),(0,o.kt)("li",{parentName:"ol"},"Makes sure that temporary problem is not leading to deletion of otherwise valuable contact")),(0,o.kt)("p",null,"Before making the final decision, I recommend checking a few versions of those rules against your database to see which variation gives you the best results without being too lax."),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"contact-deletion-archive"},"Contact Deletion Archive"),(0,o.kt)("p",null,"Deleting contacts is super fun, but sometimes you might need to know whom you have deleted. Or be able to debug recurring deletions to fix a leak in your data pipeline. Contact Deletion Archive is the way to go - it allows you to keep details of your deletions in a privacy-first way."),(0,o.kt)("p",null,"It is built with two additional elements on top of the standard Contact Deletion process described above."),(0,o.kt)("h3",{id:"contact-deletion-archive-data-extension"},"Contact Deletion Archive Data Extension"),(0,o.kt)("p",null,"It will store the information about past deletions allowing you to check multiple things securely:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Subscriber Key of deleted contacts."),(0,o.kt)("li",{parentName:"ol"},"Hashed Emails of the deleted contacts."),(0,o.kt)("li",{parentName:"ol"},"Reason for the deletion."),(0,o.kt)("li",{parentName:"ol"},"Date of first and last deletion (and, therefore, whether we deleted the SubscriberKey more than once).")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Important"),": Make sure you configure it as ",(0,o.kt)("strong",{parentName:"p"},"NOT")," sendable Data Extension. Otherwise, your Contact Deletion Process will remove data also from it."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Name"),(0,o.kt)("th",{parentName:"tr",align:null},"DataType"),(0,o.kt)("th",{parentName:"tr",align:null},"Default Value"),(0,o.kt)("th",{parentName:"tr",align:null},"Length"),(0,o.kt)("th",{parentName:"tr",align:null},"Nullable"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"\ud83d\udd11 SubscriberKey"),(0,o.kt)("td",{parentName:"tr",align:null},"Text"),(0,o.kt)("td",{parentName:"tr",align:null}),(0,o.kt)("td",{parentName:"tr",align:null},"18"),(0,o.kt)("td",{parentName:"tr",align:null},"No")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"HashedEmail"),(0,o.kt)("td",{parentName:"tr",align:null},"Text"),(0,o.kt)("td",{parentName:"tr",align:null}),(0,o.kt)("td",{parentName:"tr",align:null},"254"),(0,o.kt)("td",{parentName:"tr",align:null},"Yes")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"DeletionReason"),(0,o.kt)("td",{parentName:"tr",align:null},"Text"),(0,o.kt)("td",{parentName:"tr",align:null}),(0,o.kt)("td",{parentName:"tr",align:null},"50"),(0,o.kt)("td",{parentName:"tr",align:null},"Yes")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"FirstDeletionDate"),(0,o.kt)("td",{parentName:"tr",align:null},"Date"),(0,o.kt)("td",{parentName:"tr",align:null},"Current date"),(0,o.kt)("td",{parentName:"tr",align:null}),(0,o.kt)("td",{parentName:"tr",align:null},"Yes")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"LastDeletionDate"),(0,o.kt)("td",{parentName:"tr",align:null},"Date"),(0,o.kt)("td",{parentName:"tr",align:null}),(0,o.kt)("td",{parentName:"tr",align:null}),(0,o.kt)("td",{parentName:"tr",align:null},"No")))),(0,o.kt)("h3",{id:"contact-deletion-archive-query-activity"},"Contact Deletion Archive Query Activity"),(0,o.kt)("p",null,"We will need new Query Activity to fill that Archive Data Extension. One that moves the data from the ",(0,o.kt)("a",{parentName:"p",href:"#contact-deletion-pending-data-extension"},"Contact Deletion Pending Data Extension"),"."),(0,o.kt)("p",null,"It will leverage the ",(0,o.kt)("inlineCode",{parentName:"p"},"HASHBYTES")," function to hash the Email Address. On the one hand, it will protect the privacy of the deleted contacts and make sure no one will use them for any send. On the other - it allows you to check the list of deleted contacts against known email by hashing it the same way."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="Archive your deletions on schedule"',title:'"Archive',your:!0,deletions:!0,on:!0,'schedule"':!0},"SELECT\n      pending.SubscriberKey\n    , CONVERT(NVARCHAR(128), HASHBYTES('SHA2_256', sub.EmailAddress), 2)    AS HashedEmail\n    , pending.DeletionReason\n    , pending.DeletionDate                                                  AS LastDeletionDate\nFROM [Contact Deletion Pending DE]  AS pending\n    INNER JOIN _Subscribers         AS sub\n        ON sub.SubscriberKey = pending.SubscriberKey\n")),(0,o.kt)("p",null,"This new Query Activity should be put in the Contact Deletion Automation between the ",(0,o.kt)("a",{parentName:"p",href:"#which-contacts-should-you-delete"},"Contact Deletion Query Activity")," that selects the contacts to-be-deleted and the ",(0,o.kt)("a",{parentName:"p",href:"#contact-deletion-script-activity"},"Contact Deletion Script Activity")," that does the deed."))}p.isMDXComponent=!0}}]);