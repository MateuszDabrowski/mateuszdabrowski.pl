<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.2">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-N46LB5K"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-N46LB5K",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Mateusz DÄ…browski" href="/opensearch.xml"><title data-react-helmet="true">Solve with Cloud Apps | Mateusz DÄ…browski</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://mateuszdabrowski.pl/docs/usecase/sfmc-cloud-apps"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Solve with Cloud Apps | Mateusz DÄ…browski"><meta data-react-helmet="true" name="description" content="Create micro applications tailored to your organisation needs using only Salesforce Marketing Cloud features."><meta data-react-helmet="true" property="og:description" content="Create micro applications tailored to your organisation needs using only Salesforce Marketing Cloud features."><meta data-react-helmet="true" property="og:image" content="https://mateuszdabrowski.pl/img/logotyp-og.png"><meta data-react-helmet="true" name="twitter:image" content="https://mateuszdabrowski.pl/img/logotyp-og.png"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://mateuszdabrowski.pl/docs/usecase/sfmc-cloud-apps"><link data-react-helmet="true" rel="alternate" href="https://mateuszdabrowski.pl/docs/usecase/sfmc-cloud-apps" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://mateuszdabrowski.pl/docs/usecase/sfmc-cloud-apps" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.e19f581f.css">
<link rel="preload" href="/assets/js/runtime~main.ac0fce3e.js" as="script">
<link rel="preload" href="/assets/js/main.3102da60.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo-horizontal-light-2x.png" alt="Mateusz DÄ…browski Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-horizontal-dark-2x.png" alt="Mateusz DÄ…browski Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Docs &amp; Snippets</a><a class="navbar__item navbar__link" href="/sites/ideas">Ideas</a><a class="navbar__item navbar__link" href="/sites/my-toolset">Toolset</a></div><div class="navbar__items navbar__items--right"><a href="https://www.linkedin.com/in/mateusz-dabrowski-marketing/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-linkedin-link" aria-label="LinkedIn Profile"></a><a href="https://trailblazer.me/id/madabrowski" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-salesforce-link" aria-label="Trailblazer Profile"></a><a href="https://github.com/MateuszDabrowski" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo-horizontal-light-2x.png" alt="Mateusz DÄ…browski Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-horizontal-dark-2x.png" alt="Mateusz DÄ…browski Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs">Docs &amp; Snippets</a></li><li class="menu__list-item"><a class="menu__link" href="/sites/ideas">Ideas</a></li><li class="menu__list-item"><a class="menu__link" href="/sites/my-toolset">Toolset</a></li><li class="menu__list-item"><a href="https://www.linkedin.com/in/mateusz-dabrowski-marketing/" target="_blank" rel="noopener noreferrer" class="menu__link header-linkedin-link" aria-label="LinkedIn Profile"></a></li><li class="menu__list-item"><a href="https://trailblazer.me/id/madabrowski" target="_blank" rel="noopener noreferrer" class="menu__link header-salesforce-link" aria-label="Trailblazer Profile"></a></li><li class="menu__list-item"><a href="https://github.com/MateuszDabrowski" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Docs &amp; Snippets</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">SSJS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ssjs/ssjs-if-and-switch">If &amp; Switch</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ssjs/ssjs-loops">Loops</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ssjs/debugging-ssjs">Debugging &amp; Error Handling</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ssjs/ssjs-style-guide">Style Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ssjs/ssjs-vs-ampscript-performance">Performance</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">SSJS Use Cases</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/usecase/sfmc-cloud-apps">Solve with Cloud Apps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/usecase/engage-with-countdown">Engage with Countdown</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/usecase/tailor-with-data">Tailor with Data</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">SSJS Snippets</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ssjs/ssjs-snippet-ampscript-in-ssjs">AMPScript in SSJS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ssjs/ssjs-snippet-mobileconnect-phone-change">MobileConnect Phone Change</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">JavaScript</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/js/js-if-and-switch">If &amp; Switch</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/js/js-loops">Loops</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">JS Use Cases</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/usecase/engage-with-countdown">Engage with Countdown</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/usecase/tailor-with-data">Tailor with Data</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">AMPScript</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ampscript/ampscript-style-guide">Style Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ssjs/ssjs-vs-ampscript-performance">Performance</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">AMPScript Use Cases</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/usecase/sfmc-cloud-apps">Solve with Cloud Apps</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">AMPScript Snippets</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ssjs/ssjs-snippet-ampscript-in-ssjs">AMPScript in SSJS</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SFMC SQL</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sql/sfmc-sql-basics">SQL Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sql/sfmc-sql-select">Select</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sql/sfmc-sql-from">From</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sql/sfmc-sql-join">Join</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sql/sfmc-sql-where">Where</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sql/sfmc-sql-like">Like</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sql/sfmc-sql-string-functions">String Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sql/sfmc-sql-date-functions">Date Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sql/sfmc-sql-numeric-functions">Numeric Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sql/sfmc-sql-conversion-functions">Conversion Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sql/sfmc-sql-style-guide">Style Guide</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">SQL Snippets</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sql/sfmc-sql-snippet-debugging-email-sends">Debugging Email Sends</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sql/sfmc-sql-snippet-debugging-value-length">Debugging Value Length</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SFMC Config</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config/sfmc-config-permissions">Permissions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config/sfmc-config-system-data-views">System Data Views</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config/sfmc-config-features-on-demand">Features On Demand</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/config/sfmc-config-behavioral-triggers">Behavioral Triggers</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">Solve with Cloud Apps</h1></header><p id="leadText_16va">Create micro applications tailored to your organisation needs using only Salesforce Marketing Cloud features.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Table of Contents</h5></div><div class="admonition-content"><div class="tableOfContentsInline_3fWc"><ul class="table-of-contents"><li><a href="#cloud-apps-what-and-why">Cloud Apps: what and why</a><ul><li><a href="#when-out-of-the-box-features-are-not-enough">When out-of-the-box features are not enough</a></li><li><a href="#out-of-the-box-approach-to-out-of-the-box-feature">Out-of-the-box approach to out-of-the-box feature</a></li></ul></li><li><a href="#build-your-dream">Build your dream</a></li><li><a href="#cloud-apps-step-by-step">Cloud Apps step by step</a><ul><li><a href="#create-your-first-marketing-cloud-micro-application">Create your first Marketing Cloud micro application</a></li><li><a href="#a-good-application-is-a-secure-application">A Good application is a secure application</a></li><li><a href="#secured-cloud-app-template">Secured Cloud App Template</a></li></ul></li><li><a href="#implementation-sum-up">Implementation Sum Up</a></li></ul></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cloud-apps-what-and-why"></a>Cloud Apps: what and why<a class="hash-link" href="#cloud-apps-what-and-why" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="when-out-of-the-box-features-are-not-enough"></a>When out-of-the-box features are not enough<a class="hash-link" href="#when-out-of-the-box-features-are-not-enough" title="Direct link to heading">#</a></h3><p>Salesforce Marketing Cloud offers a multitude of options. With all the Studios, Builders, and other Salesforce-ecosystem cross-sells, you can deliver nearly anything. Nearly.</p><p>There will always be some business processes or requirements that are too niche or too unique to be covered out-of-the-box. Sometimes they can be delivered with what is available after some compromises. Sometimes only custom development can help.</p><p>Depending on the use case and company resources, you can overcome such challenges in two ways. By shopping at AppExchange - Salesforce App Store with 3rd Party solutions - or by building a custom application connected to Marketing Cloud with APIs (for example, leveraging yet another Salesforce product - Heroku).</p><p>AppExchange might be a great idea if you can find a product solving your problem, but it will add a recurring cost to your budget. On the other hand, a fully-fledged custom application might deliver precisely what you need but create considerable up-front cost (in either money for external developers or time for an in-house team) and require maintenance.</p><p>There is, however, the third path. One that can be perfect if you have a necessary but relatively small requirement for internally used power-up and would instead go lean on both budget and time â€” Marketing Cloud micro application.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="out-of-the-box-approach-to-out-of-the-box-feature"></a>Out-of-the-box approach to out-of-the-box feature<a class="hash-link" href="#out-of-the-box-approach-to-out-of-the-box-feature" title="Direct link to heading">#</a></h3><p>Marketing Cloud micro application offers AppExchange-style deep integration with Marketing Cloud platform and solution flexibility of custom development. In short, it is an application hosted on a Cloud Page and available via the main menu of Marketing Cloud. A Cloud App.</p><p>The good? You can use Marketing Cloud programmatic languages (SSJS and AMPScript) with all their nifty built-in functions to control the assets and behaviours of the SFMC platform and connected Sales &amp; Service Clouds. You can also leverage the APIs to gather even more power and pull external logic and data. All this without having to care about hosting, scaling and integration. Available directly from the Marketing Cloud menu. And cost? Just a super message for loading a Cloud Page.</p><p>The bad? It is suitable for relatively simple apps. Think about a single front-end page powered by an SSJS or AMPScript backend on a Code Resource. Of course, you can try to build something more complex, but you may quickly get into a place where the whole endeavour would have been easier with an outside-hosted application.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="build-your-dream"></a>Build your dream<a class="hash-link" href="#build-your-dream" title="Direct link to heading">#</a></h2><p>So what can you do with such a solution? Possibilities are endless, but to share a few use cases:</p><ul><li>Marketing Cloud Asset Viewer that allows you to quickly locate, for example, a Data Extension or Content asset.</li><li>Data Extension Analyzer for quick data analysis or even visualisation of values from a selected Data Extension.</li><li>KPI Dashboard displaying the most critical data for understanding your communication&#x27;s current state - or even related data from Sales or Service Cloud imported using functions enabled by Marketing Cloud Connect.</li><li>Deliverability Dashboard pulling data from Marketing Cloud and external deliverability monitoring and alerting tools.</li><li>Documentation or FAQ related to your company processes and best practices that everyone should follow when building customer experience through Marketing Cloud.</li><li>Templated Journey creator to deploy tested flows for most used campaigns in a single click.</li></ul><p>Anything related to Marketing Cloud that you wish could be a bit more automated or easy can be a good idea for a micro application approach.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cloud-apps-step-by-step"></a>Cloud Apps step by step<a class="hash-link" href="#cloud-apps-step-by-step" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="create-your-first-marketing-cloud-micro-application"></a>Create your first Marketing Cloud micro application<a class="hash-link" href="#create-your-first-marketing-cloud-micro-application" title="Direct link to heading">#</a></h3><p>Implementation is very straightforward, and you can do it in few minutes:</p><ol><li>Create a simple Cloud Page (blank page with a &quot;Hello World&quot; will do the job for now).</li><li>Publish it and copy the URL of the Cloud Page.</li><li>Go to Marketing Cloud Setup -&gt; Apps -&gt; Installed Packages and create a New Package.</li><li>Add a Marketing Cloud App Component to the Package and paste the Cloud Page URL in both Endpoint fields and Save.</li></ol><p>That&#x27;s all. You just created your first Marketing Cloud micro application. Refresh Marketing Cloud to see it available in the main menu under the AppExchange icon. Now it&#x27;s time to build up your solution to solve the business need.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="a-good-application-is-a-secure-application"></a>A Good application is a secure application<a class="hash-link" href="#a-good-application-is-a-secure-application" title="Direct link to heading">#</a></h3><p>Your micro application is now available from the Marketing Cloud menu. But unfortunately, it can also be accessed from any other place, as it is still just a simple Cloud Page. It is, of course, not ideal. You don&#x27;t want random people to access your API-fueled solution.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="api-integration-component"></a>API Integration Component<a class="hash-link" href="#api-integration-component" title="Direct link to heading">#</a></h4><p>Thankfully, you can leverage the already created Installed Package to secure the micro application cleanly. To do so, add yet another Component to the Package - this time, you will need API Integration one. Select Web App integration type and paste your micro application Cloud Page URL to the Redirect URI field.</p><p>You don&#x27;t need to select anything in the Scope to secure your micro application. But if you plan on using the API calls, feel free to choose the required areas now. If you only want to leverage built-in SSJS and AMPScript functions, keep them unchecked.</p><p>Once you save the Component, you will see that your Installed Package API Component now lists: <code>Client Id</code>, <code>Client Secret</code>, and <code>API Base URI</code>. Copy those, as you will need them in the next step.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>You Should Know</h5></div><div class="admonition-content"><p>After you create your Installed Package, three base URI&#x27;s are available - Authentication, REST and SOAP. After the <code>https://</code>, all of them have a common alphanumeric string with hyphens unique to your SFMC. I copy only this part to build any endpoint necessary for the application.</p><p>For example, for <code>https://abcdefghi-jklmnoprst-123456.auth.marketingcloudapis.com/</code>, the <code>API Base URI</code> is <code>abcdefghi-jklmnoprst-123456</code>.</p></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="api-authorisation"></a>API Authorisation<a class="hash-link" href="#api-authorisation" title="Direct link to heading">#</a></h4><p>With the above pre-work completed, you can use SSJS or AMPScript on your Cloud Page to redirect to the <code>v2/authorize</code> endpoint of your Authentication Base URI before loading. It will require any visitor to log into your Marketing Cloud to load your micro application. What&#x27;s even better, it will automatically load it for users already logged in (micro Single Sign-On).</p><p>You will need to pass <code>Client Id</code> and <code>Cloud Page URL</code> (for redirect after successful login) as query parameters to your authorisation redirect. Another necessary thing is Response Type equal to code. Finally, you can pass a State. The value of this parameter will be available after the redirect. It is excellent for recognising whether someone opened your micro application before (no state) or after (available state) logging in.</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">SSJS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">AMPScript</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">API Authentication Flow</div><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> appURL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;APP_CLOUD_PAGE_URL&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> clientID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CLIENT_ID&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> clientSecret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CLIENT_SECRET&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> clientBase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;API_BASE_URI&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">GUID</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">Redirect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;https://&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> clientBase </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.auth.marketingcloudapis.com/v2/authorize?response_type=code&amp;client_id=&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> clientID </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&amp;redirect_uri=&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> appURL </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&amp;state=&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">API Authentication Flow</div><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">VAR</span><span class="token plain"> @clientID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @clientSecret</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @clientBase</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @appURL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @session</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @requestURL</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @clientID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CLIENT_ID&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @clientSecret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CLIENT_SECRET&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @clientBase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;API_BASE_URI&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @appURL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;APP_CLOUD_PAGE_URL&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @session </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">GUID</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @requestURL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;https://&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @clientBase</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.auth.marketingcloudapis.com/v2/authorize&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;?response_type=code&amp;client_id=&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @clientID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;&amp;redirect_uri=&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @appURL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&amp;state=&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @session</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain"></span><span class="token function maybe-class-name" style="color:#d73a49">Redirect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@requestURL</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="api-authentication-with-token"></a>API Authentication with Token<a class="hash-link" href="#api-authentication-with-token" title="Direct link to heading">#</a></h4><p>Once your micro application refreshes after authorisation, you can get the code query string parameter with SSJS or AMPScript function and use it to make a POST API call to Authentication Base URI - this time to <code>v2/token</code> endpoint. As the code from the authorisation endpoint is required in the payload, the fact of receiving the token in the response will validate that the visitor is eligible to access the micro application and use it.</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">SSJS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">AMPScript</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">API Token Authorisation Flow</div><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> appURL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;APP_CLOUD_PAGE_URL&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> clientID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CLIENT_ID&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> clientSecret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CLIENT_SECRET&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> clientBase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;API_BASE_URI&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">GetQueryStringParameter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;code&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    grant_type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;authorization_code&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    code</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    client_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> clientID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    client_secret</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> clientSecret</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    redirect_uri</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> appURL</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HTTP</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">Post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;https://&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> clientBase </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.auth.marketingcloudapis.com/v2/token&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;application/json&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">StatusCode</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> parsedResponse </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token known-class-name class-name">Function</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">ParseJSON</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Response</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> accessToken </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> parsedResponse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">access_token</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> tokenExpire </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token known-class-name class-name">Function</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">SystemDateToLocalDate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token known-class-name class-name">Function</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">Now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    tokenExpire</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setMinutes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tokenExpire</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getMinutes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>You Should Know</h5></div><div class="admonition-content"><p>If you want to use the token for API in the context of a specific Business Unit, add <code>account_id: businessUnitMID,</code> to the <code>payload</code> to get the right token. Otherwise you will get autorization errors on API calls.</p></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">API Token Authorisation Flow</div><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">VAR</span><span class="token plain"> @clientID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @clientSecret</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @clientBase</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @appURL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @requestURL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @</span><span class="token maybe-class-name">APIStatus</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @response</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @clientID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CLIENT_ID&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @clientSecret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CLIENT_SECRET&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @clientBase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;API_BASE_URI&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @appURL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;APP_CLOUD_PAGE_URL&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">RequestParameter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;code&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @requestURL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;https://&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @clientBase</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.auth.marketingcloudapis.com/v2/token&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;{&quot;grant_type&quot;: &quot;authorization_code&quot;, &#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;&quot;code&quot;: &quot;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&quot;,&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;&quot;client_id&quot;: &quot;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @clientID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&quot;,&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;&quot;client_secret&quot;: &quot;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @clientSecret</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&quot;,&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;&quot;redirect_uri&quot;: &quot;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @appURL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&quot;}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain"></span><span class="token function maybe-class-name" style="color:#d73a49">HTTPPost2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@requestURL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;application/json&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @payload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @</span><span class="token maybe-class-name">APIStatus</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @token </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Substring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@</span><span class="token maybe-class-name">APIStatus</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">512</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>You Should Know</h5></div><div class="admonition-content"><p>If you want to use the token for API in the context of a specific Business Unit, add <code>&#x27;&quot;account_id&quot;: &quot;&#x27;, @businessUnitMID, &#x27;&quot;,&#x27;,</code> to the <code>@payload</code> to get the right token. Otherwise you will get autorization errors on API calls.</p></div></div></div></div></div><p>This way, you just added a micro Single Sign-On feature that is as secure as your Marketing Cloud. And that&#x27;s not all! As now only your Marketing Cloud users can access the application, you can leverage the Installed Package Access tab to control who will see your solution in the main menu.</p><p>Now you have a secure, SSO-enabled micro application deeply integrated with Marketing Cloud ready to solve your business needs and power up your Marketing Team.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>You Should Know</h5></div><div class="admonition-content"><p>Adding this micro SSO process blocks Web Studio from loading the Cloud Page in Preview. During development, you either have to comment out the SSO or validate the changes only by publishing and checking in the Cloud App directly.</p><p>It also increases the cost of using the micro application from 1 Super Message per use to 2, due to Cloud Page refresh during authorization.</p></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="capture-your-cloud-app-usage"></a>Capture your Cloud App usage<a class="hash-link" href="#capture-your-cloud-app-usage" title="Direct link to heading">#</a></h4><p>We can also add a logging solution that will store session and log app use history. We will need a Data Extension (one can serve multiple Cloud Apps) and a bit more code around the above snippets.</p><p>Create Data Extension with the following structure (<code>session</code> column being the Primary Key):</p><table><thead><tr><th>Name</th><th>DataType</th><th>Default Value</th><th>Length</th><th>Nullable</th></tr></thead><tbody><tr><td>ðŸ”‘ session</td><td>Text</td><td></td><td>50</td><td>No</td></tr><tr><td>appName</td><td>Text</td><td></td><td>50</td><td>Yes</td></tr><tr><td>createdDate</td><td>Date</td><td>Current date</td><td></td><td>Yes</td></tr><tr><td>token</td><td>Text</td><td></td><td>520</td><td>Yes</td></tr><tr><td>tokenExpire</td><td>Date</td><td></td><td></td><td>Yes</td></tr></tbody></table><p>As for data retention, one day for Individual Records is enough for authorisation purposes. However, you can extend it for logging history purposes. Keep in mind that the more data stored, the slower the Data Extension operations speeds. Pushing data to this table is straightforward:</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">SSJS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">AMPScript</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Fill Cloud App Logging Data Extension</div><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token known-class-name class-name">Function</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">UpsertData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">authDE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;session&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;appName&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;token&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;tokenExpire&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">appName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> accessToken</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tokenExpire</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Fill Cloud App Logging Data Extension</div><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function maybe-class-name" style="color:#d73a49">UpsertData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@authDE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;session&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;appName&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @appName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;token&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;tokenExpire&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">DateAdd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function maybe-class-name" style="color:#d73a49">Now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;MI&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div></div><p>It will additionally allow you to safely split your application into the front end (Cloud Page) and back end (Code Resource) to improve user experience and optimise speed and cost.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="secured-cloud-app-template"></a>Secured Cloud App Template<a class="hash-link" href="#secured-cloud-app-template" title="Direct link to heading">#</a></h3><p>By considering all the above, we get a robust and secure template for our Cloud Apps:</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">SSJS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">AMPScript</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Full Cloud App Template</div><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">script runat</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;server&#x27;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* -------------------------------------------------------------------------</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="display:inline-block;color:#999988;font-style:italic">
</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    Authenticates each visitor to limit access only to SFMC logged-in users.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="display:inline-block;color:#999988;font-style:italic">
</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    1. Global Variables</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    2. Helper Functions</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    2.1. Debugging</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    2.2. Error handling</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    3. Authentication Flow</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    3.1. Authorisation</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    3.2. Authentication with REST Token</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    3.2.1. Build token request payload</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    3.2.2. Request the token</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    3.2.3. Destructure the response</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    3.2.4. Upsert Logging Data Extension</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    3.2.5. Handle authentication error</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    3.3. Authorisation Error</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="display:inline-block;color:#999988;font-style:italic">
</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    -------------------------------------------------------------------------- */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">Load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;core&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ---------------------- 1. GLOBAL VARIABLES ---------------------------- */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> debugging </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> appName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CLOUD_APP_NAME&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> appURL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;APP_CLOUD_PAGE_URL&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> clientID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CLIENT_ID&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> clientSecret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CLIENT_SECRET&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> clientBase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;API_BASE_URI&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> authDE </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;AUTHENTICATION_DATA_EXTENSION&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">GetQueryStringParameter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;state&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> errorMessage </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">GetQueryStringParameter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;error&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> errorDescription </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">GetQueryStringParameter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;error_description&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> errorDE </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ERROR_DATA_EXTENSION&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> errorURL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ERROR_CLOUD_PAGE_URL&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ---------------------- 2. HELPER FUNCTIONS ---------------------------- */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ---------------------- 2.1. Debugging --------------------------------- */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    * @function debugValue</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    * @description Outputs provided description and SSJS value to front-end in a type-safe &amp; consistent way</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    * @param {string} description - Describes meaning of the second parameter in the output</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    * @param {*} value - The value that needs to be debugged</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">debugValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">description</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function maybe-class-name" style="color:#d73a49">Write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">description </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;: &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;object&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;br&gt;&lt;br&gt;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ---------------------- 2.2. Error handling ---------------------------- */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    * @function handleError</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    * @description Adds the error with context to error logging Data Extension and redirects to error page.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    * @param {Object} error - The caught error object. Can come from the try/catch block or be manually created.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    * @param {string} error.message - First error key stores short error message describing the issue.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    * @param {string} error.description - Second error key stores detailed error path helping with root cause analysis</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handleError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">debugging</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">debugValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Found error&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Remember that if your Logging Data Extension is in Shared Folder, you need to add the &quot;ENT.&quot; prefix to name</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token known-class-name class-name">Function</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">InsertData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">errorDE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;id&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;appName&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;errorMessage&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;errorDescription&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">GUID</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> appName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">description</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">Redirect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">errorURL </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;?error=&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">message</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&amp;error_description=&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">description</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ---------------------- 3. AUTHENTICATION FLOW ------------------------- */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ---------------------- 3.1. Authorization ----------------------------- */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">state </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">errorMessage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">GUID</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">Redirect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;https://&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> clientBase </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.auth.marketingcloudapis.com/v2/authorize?response_type=code&amp;client_id=&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> clientID </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&amp;redirect_uri=&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> appURL </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&amp;state=&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ---------------------- 3.2. Authentication ---------------------------- */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* 3.2.1. Build token request payload */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">GetQueryStringParameter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;code&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            grant_type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;authorization_code&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            code</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            client_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> clientID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            client_secret</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> clientSecret</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            redirect_uri</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> appURL</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* 3.2.2. Request the token */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HTTP</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">Post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;https://&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> clientBase </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.auth.marketingcloudapis.com/v2/token&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;application/json&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* 3.2.3. Destructure the response */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">StatusCode</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> parsedResponse </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token known-class-name class-name">Function</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">ParseJSON</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Response</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> accessToken </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> parsedResponse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">access_token</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> appScope </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> parsedResponse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">scope</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> tokenExpire </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token known-class-name class-name">Function</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">SystemDateToLocalDate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token known-class-name class-name">Function</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">Now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tokenExpire</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setMinutes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tokenExpire</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getMinutes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">/* 3.2.4. Upsert Logging Data Extensions */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token maybe-class-name">Platform</span><span class="token punctuation" style="color:#393A34">.</span><span class="token known-class-name class-name">Function</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access maybe-class-name" style="color:#d73a49">UpsertData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">authDE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;session&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;appName&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;token&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;tokenExpire&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">appName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> accessToken</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tokenExpire</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* 3.2.5. Handle authentication error */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">handleError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Authentication Failed&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Status: &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">StatusCode</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ---------------------- 3.3. Authorization Error ----------------------- */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">handleError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> errorMessage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> description</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> errorDescription</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">script</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">--</span><span class="token plain"> </span><span class="token maybe-class-name">The</span><span class="token plain"> </span><span class="token maybe-class-name">Cloud</span><span class="token plain"> </span><span class="token maybe-class-name">App</span><span class="token plain"> micro </span><span class="token constant" style="color:#36acaa">SSO</span><span class="token plain"> solution will secure anything you create below </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>You Should Know</h5></div><div class="admonition-content"><p>Any reload done within the app (Reload/Redirect/Post via Form) should point back to Apps Cloud Page URL with <code>&#x27;state=&#x27; + state</code> appended to it as a query parameter (remember to use <code>?</code> if it will be the first parameter or <code>&amp;</code> in another case).</p><p>You can also leverage the session to lookup the token for API calls: <code>Platform.Function.Lookup(authDE, &#x27;token&#x27;, &#x27;session&#x27;, state)</code></p></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Full Cloud App Template</div><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">--</span><span class="token plain"> </span><span class="token maybe-class-name">Authorisation</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">START</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">%</span><span class="token operator" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ---------------------------------------------------------------------</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="display:inline-block;color:#999988;font-style:italic">
</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    Authenticates each visitor to limit access only to SFMC logged-in users.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="display:inline-block;color:#999988;font-style:italic">
</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    1. Global Variables - should be updated for each implementation</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    2. Authentication Flow</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    2.1. Session Validation</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    2.2. Authorisation</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    2.3. Authentication with REST Token</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    2.3.1. Build token request payload</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    2.3.2. Get the token</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    2.3.3. Upsert Logging Data Extension</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="display:inline-block;color:#999988;font-style:italic">
</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    --------------------------------------------------------------------- */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ---------------------- 1. GLOBAL VARIABLES ----------------------- */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">VAR</span><span class="token plain"> @appName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @clientID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @clientSecret</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @clientBase</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @appURL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @errorURL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @requestURL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @payload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @</span><span class="token maybe-class-name">APIStatus</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @response</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @session</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @authDE</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* Add clientID, Client Secret, Client Base (part of API Base URL) for all further calls*/</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @clientID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CLIENT_ID&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @clientSecret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CLIENT_SECRET&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @clientBase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;API_BASE_URI&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* App Nane and relevant URLs */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @appName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CLOUD_APP_NAME&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @appURL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;APP_CLOUD_PAGE_URL&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @errorURL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ERROR_CLOUD_PAGE_URL&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* Data Extension for Authorisation Logging */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @authDE </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;AUTHENTICATION_DATA_EXTENSION&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* Capture State and Session for Authorisation purposes */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">RequestParameter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;state&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @session </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">RequestParameter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;s&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ---------------------- 2. AUTHENTICATION FLOW -------------------- */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ---------------------- 2.1. Session Validation ------------------------ */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* If there is Session parameter, validate it with logging DE*/</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">IF</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NOT</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Empty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@session</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">THEN</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* If user was authenticated for another app or if he is not authenticated, redirect to login page */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token constant" style="color:#36acaa">IF</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Lookup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@authDE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;appName&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;session&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @session</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> @appName </span><span class="token constant" style="color:#36acaa">THEN</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function maybe-class-name" style="color:#d73a49">Redirect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@appURL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token constant" style="color:#36acaa">ENDIF</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Authenticated users jumps to main code */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ---------------------- 2.2. Authorization ------------------------ */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* If there is no Session parameter, start Authorisation flow */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">ELSEIF</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Empty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">AND</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Empty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@session</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">THEN</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @session </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">GUID</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @requestURL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&#x27;https://&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @clientBase</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.auth.marketingcloudapis.com/v2/authorize&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&#x27;?response_type=code&amp;client_id=&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @clientID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&#x27;&amp;redirect_uri=&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @appURL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&amp;state=&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @session</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function maybe-class-name" style="color:#d73a49">Redirect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@requestURL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* ---------------------- 2.3. Authentication ----------------------- */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* If there is state parameter after Authorisation, get the REST Token */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">ELSEIF</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NOT</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Empty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">THEN</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">RequestParameter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;code&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @requestURL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;https://&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @clientBase</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.auth.marketingcloudapis.com/v2/token&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* 2.3.1. Build token request payload */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&#x27;{&quot;grant_type&quot;: &quot;authorization_code&quot;,&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&#x27;&quot;code&quot;: &quot;&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">@code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&quot;,&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&#x27;&quot;client_id&quot;: &quot;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @clientID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&quot;,&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&#x27;&quot;client_secret&quot;: &quot;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @clientSecret</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&quot;,&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&#x27;&quot;redirect_uri&quot;: &quot;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @appURL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&quot;}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* 2.3.2. Get the token */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function maybe-class-name" style="color:#d73a49">HTTPPost2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@requestURL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;application/json&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @payload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @</span><span class="token maybe-class-name">APIStatus</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token constant" style="color:#36acaa">SET</span><span class="token plain"> @token </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Substring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@</span><span class="token maybe-class-name">APIStatus</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">512</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Token expires after an 18 minutes */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* 2.3.2. Upsert Logging Data Extension */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Add record to Logging DE to store the token and validate access with it */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function maybe-class-name" style="color:#d73a49">UpsertData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@authDE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;session&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">@state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;appName&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @appName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;token&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;tokenExpire&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">DateAdd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function maybe-class-name" style="color:#d73a49">Now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;MI&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function maybe-class-name" style="color:#d73a49">Redirect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function maybe-class-name" style="color:#d73a49">Concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@appURL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;?s=&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* For any other scenario, redirect to Error Page  */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">ELSE</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function maybe-class-name" style="color:#d73a49">Redirect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@errorURL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">ENDIF</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* Remember to pass ?s=%%=v(@session)=%% on each page reload for leverage session validation */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">%</span><span class="token operator" style="color:#393A34">%</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">--</span><span class="token plain"> </span><span class="token maybe-class-name">Authorisation</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">END</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">--</span><span class="token plain"> </span><span class="token maybe-class-name">The</span><span class="token plain"> </span><span class="token maybe-class-name">Cloud</span><span class="token plain"> </span><span class="token maybe-class-name">App</span><span class="token plain"> micro </span><span class="token constant" style="color:#36acaa">SSO</span><span class="token plain"> solution will secure anything you create below </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>You Should Know</h5></div><div class="admonition-content"><p>Any reload done within the app (Reload/Redirect/Post via Form) should point back to Apps Cloud Page URL with <code>s=%%=v(@session)=%%</code> appended to it as a query parameter (remember to use <code>?</code> if it will be the first parameter or <code>&amp;</code> in another case).</p><p>You can also leverage the session to lookup the token for API calls: <code>%%=Lookup(@authDE,&#x27;token&#x27;,&#x27;session&#x27;,@session)=%%</code></p></div></div></div></div></div><p>To implement it, copy and paste the above code to the top of the Cloud Page used for the App. Next, change the values at the top of the code (the uppercase ones) to match your package installation and app details. That&#x27;s all!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="implementation-sum-up"></a>Implementation Sum Up<a class="hash-link" href="#implementation-sum-up" title="Direct link to heading">#</a></h2><p>There was much information to digest, so it&#x27;s time for a streamlined step by step guide from zero to hero:</p><ol><li><strong>Logging Data Extensions</strong><ol><li>In Content Builder or Email Studio create a <a href="#capture-your-cloud-app-usage">Cloud App Logging Data Extension</a>.</li><li>In Content Builder or Email Studio create an <a href="/docs/ssjs/debugging-ssjs#logging-to-data-extension">Error Logging Data Extension</a>.</li><li>In both cases, one is enough for multiple Cloud Apps. If stored in the Shared Data Extensions folder, both can serve multiple Business Units.</li></ol></li><li><strong>Cloud Page</strong><ol><li>Create a new Cloud Page.</li><li>Copy the URL.</li></ol></li><li><strong>Installed Package</strong><ol><li>Go to System -&gt; Platform Tools -&gt; Apps -&gt; Installed Packages.</li><li>Click <code>New</code> in the top right corner.</li><li>Add Unique Name and Description suggesting the App&#x27;s purpose.</li><li>Marketing Cloud App Component.<ol><li>Click <code>Add Component</code> at the bottom.</li><li>Select <code>Marketing Cloud App</code> and click Next.</li><li>Add Unique Name and Description suggesting the App&#x27;s purpose.</li><li>Add Cloud Page URL copied in step 2.ii as both Login and Logout Endpoint.</li><li>Click <code>Save</code>.</li></ol></li><li>API Integration Component.<ol><li>Click <code>Add Component</code> on the right side of the page.</li><li>Select <code>API Integration</code> and click Next.</li><li>Select <code>Web App</code> and click Next.</li><li>Add Cloud Page URL copied in step 2.ii as Redirect URI.</li><li>Add Scope of the App (should be minimal, can be extended later) and click <code>Save</code>.</li></ol></li><li>Copy <code>Client Id</code>, <code>Client Secret</code> and <code>Client Base URI</code>.</li></ol></li><li><strong>Menu Unlock</strong><ol><li>Refresh tab with Marketing Cloud.</li><li>On the main menu pane of Marketing Cloud, hover over AppExchange to see your application.</li></ol></li><li><strong>Secured Template</strong><ol><li>Copy the <a href="#secured-cloud-app-template">template</a> in the prefered language to the Cloud Page from step 2.i.</li><li>Update the unique values in the variables at the top part of the template (CAPS_LOCK placeholders).</li></ol></li><li><strong>Build your solution</strong></li></ol></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/MateuszDabrowski/mateuszdabrowski.pl/edit/master/docs/usecase/sfmc-cloud-apps.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF">Last updated on <b><time datetime="2021-06-27T22:09:01.000Z">6/28/2021</time></b> by <b>Mateusz DÄ…browski</b></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/ssjs/ssjs-vs-ampscript-performance"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Performance</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/usecase/engage-with-countdown"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Engage with Countdown Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#cloud-apps-what-and-why" class="table-of-contents__link">Cloud Apps: what and why</a><ul><li><a href="#when-out-of-the-box-features-are-not-enough" class="table-of-contents__link">When out-of-the-box features are not enough</a></li><li><a href="#out-of-the-box-approach-to-out-of-the-box-feature" class="table-of-contents__link">Out-of-the-box approach to out-of-the-box feature</a></li></ul></li><li><a href="#build-your-dream" class="table-of-contents__link">Build your dream</a></li><li><a href="#cloud-apps-step-by-step" class="table-of-contents__link">Cloud Apps step by step</a><ul><li><a href="#create-your-first-marketing-cloud-micro-application" class="table-of-contents__link">Create your first Marketing Cloud micro application</a></li><li><a href="#a-good-application-is-a-secure-application" class="table-of-contents__link">A Good application is a secure application</a></li><li><a href="#secured-cloud-app-template" class="table-of-contents__link">Secured Cloud App Template</a></li></ul></li><li><a href="#implementation-sum-up" class="table-of-contents__link">Implementation Sum Up</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs &amp; Snippets</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/ssjs/ssjs-if-and-switch">SSJS</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/js/js-if-and-switch">JavaScript</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/ampscript/ampscript-style-guide">AMPScript</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/sql/sfmc-sql-basics">SFMC SQL</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/config/sfmc-config-features-on-demand">SFMC Config</a></li></ul></div><div class="col footer__col"><div class="footer__title">About</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/sites/my-toolset">Toolset</a></li><li class="footer__item"><a class="footer__link-item" href="/sites/ideas">Ideas</a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/sites/licence">Licence &amp; Attribution</a></li><li class="footer__item"><a class="footer__link-item" href="/sites/privacy">Privacy</a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/assets/js/runtime~main.ac0fce3e.js"></script>
<script src="/assets/js/main.3102da60.js"></script>
</body>
</html>