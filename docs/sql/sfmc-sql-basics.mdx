---
id: sfmc-sql-basics
title: SFMC SQL Basics
sidebar_label: SQL Basics
description: SELECT your data FROM Salesforce Marketing Cloud WHERE drag-and-drop Filters are not enough.
image: img/og/og-image-sql-basics.png
tags: [Marketing Cloud, SQL]
---

import { LeadText } from '../../src/components/LeadText.js';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import DocCardList from '@theme/DocCardList';

<LeadText content='SELECT your data FROM Salesforce Marketing Cloud WHERE drag-and-drop Filters are not enough.' />

## How to segment data in Marketing Cloud

Salesforce Marketing Cloud offers few different ways of segmenting data for your marketing needs. Out-of-the-box, you can use Filters and SQL Query Activities.

Filters are strightforward, drag-and-drop solution for one-time (Filtered Data Extensions) or refreshed on schedule (Data Filters with Automation) segmentation. Unfortunatelly, they are very limited, as they allow you to just copy single Data Extension with all its columns with filtered down amount of rows. That filtering can leverage source Data Extension values, another Data Extension values (through Data Relationship) or Measures. That's it. For real Marketing Automation, it's not enough.

This is why you are looking to learn about SFMC SQL. Along with Automation Studio Query Activity it will allow you to deploy any segmentation scenario you might want with full control over the output columns, names and values. However, with great power comes some learning required.

There is also a third way - paid AppExchange solutions that offer you a way to eat a cookie and have a cookie: full power of SQL with a drag-and-drop interface. For a price.

You can check my comparision of all above options in my [here](../config/sfmc-appexchange-solutions.mdx#sfmc-segmentation-solutions). In this article we will focus only on the most powerful and free option - SFMC SQL.

## SQL in Salesforce Marketing Cloud

SQL (Structured Query Language) is one of the best ways to work with relational databases. And Marketing Cloud's Data Extensions, with the help of Data Designer, offers precisely that. A relational database. Same for system Data Views containing tracking data. Because of this, SQL is used in SFMC whenever powerful segmentation is needed (mostly using Automation Studio).

The main difference from standard SQL (SFMC uses more or less SQL Server 2016) is that SFMC supports only `SELECT` statement. Neither `INSERT`, `UPDATE` or `DELETE` are officially supported. It is because the queries are executed as a part of the backend query and are limited to provide non-breakable functionality.

Another limiting characteristic of SFMC SQL is visible in the data accessible by queries. Only data stored in data extensions or system data views is available. Moreover, you can save the results only to the data extensions. The reason is other data structures of SFMC are not relational databases.

Finally, the significant limitation that you might hit as your Marketing Cloud grows is the AutoKill. It will automatically stop your query if execution time exceeds the 30 minutes limit. Think about the query with the future in mind. It is especially important for queries that are supposed to be backbones of your data management flow in Marketing Cloud. Even if it works great now, consider how it will behave once you have more data in the system. One of the great ways to not trigger AutoKill is to implement retention periods for the Data Extensions used in the query to limit input data.

## Where to learn SFMC SQL

Before we start witht the real deal, let's cover where to learn writing SQL. My recommendation is to get a [Query Studio](../config/sfmc-appexchange-solutions.mdx#query-studio). It's a free AppExchange add-on to Marketing Cloud developed by Salesforce. While it has its cons, it's perfect for quickly learning how to query.

If you cannot install this app in your Marketing Cloud, you still can learn using Query Activities in Automation Studio, but it will be much less user-friendly. For each change in the query you will have to update the target Data Extension manually and go through multiple steps across the platform to see the results.

My personal approach is to always start in [Query Studio](../config/sfmc-appexchange-solutions.mdx#query-studio) and only once my SQL Query is complete and validated I move it to Automation Studio.

## How to learn SFMC SQL

SFMC SQL is very limited compared to full power of Structured Query Language, but there is still quite a lot of topics to cover. To make it easier, I split them into steps that slowly add more complex concepts. Still, every step should give you some tangible knowledge that you can actively use in your work.

In each level you will see:

1. Learning materials to read.
2. Exercise you can do in your own Marketing Cloud platform to test your skills.
3. Hint that can help you with the exercise if you are stuck.
4. Example solution to that exercise. Keep in mind that there might be more than one correct approach.

---

### Level 1 - SELECT, FROM, WHERE

On this level you learn three most important SQL statements that are core for all queries. They will give you similar power to what Filters can do - with added bonus of choosing columns you need for your final segment.

#### Learning materials

- [SELECT](./sfmc-sql-select.mdx) - just the first part, before the aliasing section.
- [FROM](./sfmc-sql-from.mdx) - whole article.
- [WHERE](./sfmc-sql-where.mdx) - the first part, before the Basic Operators, plus [Equality Operators](./sfmc-sql-where.mdx#equality-operators) and [Logical Operators](./sfmc-sql-where.mdx#logical-operators). Don't worry about Comparison operators or shorthands for now. Don't worry about the examples with dates and unknown functions. We will get there. For now, think about how you can filter based on simple value, like status.
- [System Data Views](../config/sfmc-system-data-views.mdx) - the basics and [_Subscribers](../config/sfmc-system-data-views.mdx#_subscribers) Data View.

#### Check your skills

<Tabs
    defaultValue='exercise'
    values={[
        {label: 'Exercise', value: 'exercise'},
        {label: 'Hints', value: 'hints'},
        {label: 'Solution', value: 'solution'},
    ]}
>
<TabItem value='exercise'>

Write a query that will find Subscriber Key for all Active (opted-in) Subscribers in your All Subscribers list.

</TabItem>
<TabItem value='hints'>

1. All Subscribers List data is stored in [_Subscribers](../config/sfmc-system-data-views.mdx#_subscribers) Data View.
2. If you are running your query on a child Business Unit, you will need to use [`Ent.` prefix](./sfmc-sql-from.mdx#enterprise-system-data-views).
3. You don't have to [SELECT](./sfmc-sql-select.mdx) any columns but the SubscriberKey. You can use [WHERE](./sfmc-sql-where.mdx) on not selected columns.
4. Current status of a Subscriber is saved in `Status` column of [_Subscribers](../config/sfmc-system-data-views.mdx#_subscribers) Data View as a string. You can use it for filtering with [WHERE](./sfmc-sql-where.mdx).

</TabItem>
<TabItem value='solution'>

```sql title="Solution working on Parent Business Unit"
SELECT SubscriberKey
FROM _Subscribers
WHERE Status = 'active'
```

Bonus: you can change the last line to, for example, `WHERE Domain = 'gmail.com'` to see how many Subscribers are using free Google inbox.

</TabItem>
</Tabs>

---

### Level 2 - JOIN, Aliasing, NULL

On this level you learn how to leverage second Data Extension or Data View, how to change column name for the output and how to deal with basic `NULL` cases.

#### Learning materials

- [JOIN](./sfmc-sql-join.mdx) - [JOIN Types](./sfmc-sql-join.mdx#join-types), [Joining ON](./sfmc-sql-join.mdx#joining-on) and [Table Name Prefixes](./sfmc-sql-join.mdx#table-name-prefix) sections. It might be helpful to check out the [visual cheatsheet](./sfmc-sql-join.mdx#sfmc-sql-join-cheat-sheet) as well.
- [Aliasing](./sfmc-sql-select.mdx#aliasing-with-as) - just the Aliasing with AS and Custom values sections.
- [NULL functions](./sfmc-sql-null-functions.mdx) - just the first three paragraphs and [IS NULL](./sfmc-sql-null-functions.mdx#is-null) section.
- [_Sent](../config/sfmc-system-data-views.mdx#_sent), [_Open](../config/sfmc-system-data-views.mdx#_open) and [_Click](../config/sfmc-system-data-views.mdx#_click) Data Views.

#### Check your skills

<Tabs
    defaultValue='exercise'
    values={[
        {label: 'Exercise', value: 'exercise'},
        {label: 'Hints', value: 'hints'},
        {label: 'Solution', value: 'solution'},
    ]}
>
<TabItem value='exercise'>

Write a query that will find Subscriber Key for all Active (opted-in) Subscribers in your All Subscribers list that were sent an email in the last 6 months.

</TabItem>
<TabItem value='hints'>

1. Don't write SQL from scratch. Leverage what you already have.
2. Sent data is stored in [_Sent](../config/sfmc-system-data-views.mdx#_sent) Data View.
3. You don't have to worry about 6 months requirement, because _Sent Data View is storing only 6 months of data.
4. You can chain multiple filters using [`WHERE` Logical Operators](./sfmc-sql-where.mdx#logical-operators).
5. [LEFT JOIN](./sfmc-sql-join.mdx#left-and-right-joins) will add columns even if there is no data in second table.
6. You can find those records without data in second table using [`IS NULL`](./sfmc-sql-null-functions.mdx#is-null).
7. You need to join tables [`ON`](./sfmc-sql-join.mdx#joining-on) a common value.

</TabItem>
<TabItem value='solution'>

```sql title="Solution working on Parent Business Unit"
SELECT sub.SubscriberKey
FROM _Subscribers AS sub
    LEFT JOIN _Sent AS sent
        ON sent.SubscriberKey = sub.SubscriberKey
WHERE
    sub.Status = 'active'
    AND sent.EventDate IS NOT NULL
```

Bonus: Change `IS NOT NULL` to `IS NULL` in the last line to see how many active Subsribers haven't received any communication in last 6 months. Might be nice segment for win-back journey!

</TabItem>
</Tabs>

---

### Level 3 - LIKE, CASE, Strings

On this level you learn how to deal with string values, how to implement SQL version of if/else logic and how to make complex conditions calculating your own data. With this, you are no longer limited to the data already available in the tables.

#### Learning materials

- [LIKE](./sfmc-sql-like.mdx) - whole article, but focus on [LIKE with Wildcard](./sfmc-sql-like.mdx#like-with-wildcard), you will use it more. Check out also [LIKE operator in WHERE](./sfmc-sql-where.mdx#like-operator) section.
- [CASE](./sfmc-sql-case.mdx) - whole article plus [CASE operator in WHERE](./sfmc-sql-where.mdx#case-operator) section.
- [String functions](./sfmc-sql-string-functions.mdx) - check out all, but focus on most frequently used [LEFT & RIGHT](./sfmc-sql-string-functions.mdx#left--right), [LEN](./sfmc-sql-string-functions.mdx#len) and [CHARINDEX](./sfmc-sql-string-functions.mdx#charindex).

#### Check your skills

<Tabs
    defaultValue='exercise'
    values={[
        {label: 'Exercise', value: 'exercise'},
        {label: 'Hints', value: 'hints'},
        {label: 'Solution', value: 'solution'},
    ]}
>
<TabItem value='exercise'>

Write a query that will find Subscriber Key for all Subscribers in your All Subscribers list and add a new column, called `SubscriberKeyType`. In that new column calculate whether the Subscriber Key is using email address, Salesforce ID (and in this case - source object) or other. Possible values should be: `Email`, `Account`, `Contact`, `User`, `Lead`, `Other`.

:::note You Should Know

For our need here, if the Subscriber Key has 18 characters, no `@` and starts with a three specific characters, it probably is a Salesforce ID. Th0se first three characters point to a specific Salesforce Object being a source of that record:

- 001 = Account
- 003 = Contact
- 005 = User
- 00Q = Lead

:::

</TabItem>
<TabItem value='hints'>

1. The easiest way to find an email is to use [LIKE with Wildcard](./sfmc-sql-like.mdx#like-with-wildcard) looking for `{something}@{domain}.{tld}`.
2. [CASE](./sfmc-sql-case.mdx) returns value assigned to first scenario that matched, so the order of `WHEN`s makes a difference.
3. You can use multiple conditions and [String functions](./sfmc-sql-string-functions.mdx) in `WHEN` checks.
4. [CASE](./sfmc-sql-case.mdx) can create new column when you use it in [SELECT with an alias](./sfmc-sql-select.mdx#aliasing-with-as).

</TabItem>
<TabItem value='solution'>

```sql title="Solution working on Parent Business Unit. The results will differ a lot depending on your SFMC implementation."
SELECT
      SubscriberKey
    , CASE
        WHEN SubscriberKey LIKE '%@%.%'                                 THEN 'Email'
        WHEN LEN(SubscriberKey) = 18 AND LEFT(SubscriberKey, 3) = '001' THEN 'Account'
        WHEN LEN(SubscriberKey) = 18 AND LEFT(SubscriberKey, 3) = '003' THEN 'Contact'
        WHEN LEN(SubscriberKey) = 18 AND LEFT(SubscriberKey, 3) = '005' THEN 'User'
        WHEN LEN(SubscriberKey) = 18 AND LEFT(SubscriberKey, 3) = '00Q' THEN 'Lead'
        ELSE 'Other'
      END AS SubscriberKeyType
FROM _Subscribers
```

While you could use `LIKE` for all the conditions, `LEFT` will perform better in this `CASE` because it will make a comparison only on the first three characters instead of anywhere in the whole string.

This query is great to understand what is the source of your Subscribers. It will be even more useful later on, when you learn how to aggregate the data. With it, you will be able to quickly see exact numbers of subscribers from each source.

</TabItem>
</Tabs>

---

### Level 4 - Dates, WHERE operators, Conversion

#### Learning materials

- [Date functions](./sfmc-sql-date-functions.mdx) - [GETDATE](./sfmc-sql-date-functions.mdx#getdate--getutcdate) and [DATEADD](./sfmc-sql-date-functions.mdx#dateadd) are the most important sections.
- [WHERE](./sfmc-sql-where.mdx) - while we already covered parts of where, this is time to make a deeper dive into [Comparison operators](./sfmc-sql-where.mdx#comparison-operators), [BETWEEN shorthand](./sfmc-sql-where.mdx#between-shorthand) and [IN shorthand](./sfmc-sql-where.mdx#in-shorthand).
- [Conversion functions](./sfmc-sql-conversion-functions.mdx) - whole article, but treat Data Types and Data Style Codes more as a reference material.


#### Check your skills

<Tabs
    defaultValue='exercise'
    values={[
        {label: 'Exercise', value: 'exercise'},
        {label: 'Hints', value: 'hints'},
        {label: 'Solution', value: 'solution'},
    ]}
>
<TabItem value='exercise'>


</TabItem>
<TabItem value='hints'>

1.

</TabItem>
<TabItem value='solution'>

```sql title="Solution working on Parent Business Unit"

```

Bonus:

</TabItem>
</Tabs>

---

### Level 5

#### Learning materials

-

#### Check your skills

<Tabs
    defaultValue='exercise'
    values={[
        {label: 'Exercise', value: 'exercise'},
        {label: 'Hints', value: 'hints'},
        {label: 'Solution', value: 'solution'},
    ]}
>
<TabItem value='exercise'>


</TabItem>
<TabItem value='hints'>

1.

</TabItem>
<TabItem value='solution'>

```sql title="Solution working on Parent Business Unit"

```

Bonus:

</TabItem>
</Tabs>

---

Knowing the available functions is one thing. Writing good and readable queries - another. Salesforce Marketing Cloud is always a team sport, so be sure to leverage the power of a [Style Guide](./sfmc-sql-style-guide.mdx) to improve the quality of your SQL.

## Order of operations

One of the key things to remember when building more complex queries is the order of operations, as it will decide what is in the output:

[`FROM`](./sfmc-sql-from.mdx) > [`WHERE`](./sfmc-sql-where.mdx) > [`GROUP BY`](#group-by) > [`HAVING`](#having) > [`DISTINCT`](./sfmc-sql-select.mdx#distinct) > [`ORDER BY`](./sfmc-sql-select.mdx#top-with-order-by)

It means that rows filtered with `WHERE` will not be taken into consideration for `GROUP BY` and that `DISTINCT` deduplication will be applied to results grouped and filtered by `HAVING` - not the source data.

## All SQL Guides

<DocCardList />